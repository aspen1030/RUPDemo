<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Adler Dataset: Extensions to the Mean IPM - Incorporating Year | RUPDemo Digitization Guide</title>
  <meta name="description" content="6 Adler Dataset: Extensions to the Mean IPM - Incorporating Year | RUPDemo Digitization Guide" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Adler Dataset: Extensions to the Mean IPM - Incorporating Year | RUPDemo Digitization Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="docs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Adler Dataset: Extensions to the Mean IPM - Incorporating Year | RUPDemo Digitization Guide" />
  
  
  



<meta name="date" content="2024-09-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="adex.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="part"><span><b>I General Guidelines</b></span></li>
<li class="chapter" data-level="1" data-path="codestd.html"><a href="codestd.html"><i class="fa fa-check"></i><b>1</b> Coding Standards</a>
<ul>
<li class="chapter" data-level="1.1" data-path="codestd.html"><a href="codestd.html#starting-a-new-script"><i class="fa fa-check"></i><b>1.1</b> Starting a new script</a></li>
<li class="chapter" data-level="1.2" data-path="codestd.html"><a href="codestd.html#organizing-scripts"><i class="fa fa-check"></i><b>1.2</b> Organizing scripts</a></li>
<li class="chapter" data-level="1.3" data-path="codestd.html"><a href="codestd.html#formatting-sections-and-comments"><i class="fa fa-check"></i><b>1.3</b> Formatting sections and comments</a></li>
<li class="chapter" data-level="1.4" data-path="codestd.html"><a href="codestd.html#coding-style"><i class="fa fa-check"></i><b>1.4</b> Coding style</a></li>
<li class="chapter" data-level="1.5" data-path="codestd.html"><a href="codestd.html#writing-functions"><i class="fa fa-check"></i><b>1.5</b> Writing functions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="projorg.html"><a href="projorg.html"><i class="fa fa-check"></i><b>2</b> Project Organization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="projorg.html"><a href="projorg.html#folder-organization"><i class="fa fa-check"></i><b>2.1</b> Folder organization</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="projorg.html"><a href="projorg.html#r-folder"><i class="fa fa-check"></i><b>2.1.1</b> R folder</a></li>
<li class="chapter" data-level="2.1.2" data-path="projorg.html"><a href="projorg.html#data-folder"><i class="fa fa-check"></i><b>2.1.2</b> Data folder</a></li>
<li class="chapter" data-level="2.1.3" data-path="projorg.html"><a href="projorg.html#results-folder"><i class="fa fa-check"></i><b>2.1.3</b> Results folder</a></li>
<li class="chapter" data-level="2.1.4" data-path="projorg.html"><a href="projorg.html#example-of-folder-organization"><i class="fa fa-check"></i><b>2.1.4</b> Example of folder organization</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="projorg.html"><a href="projorg.html#more-complicated-datasets"><i class="fa fa-check"></i><b>2.2</b> More complicated datasets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="genwf.html"><a href="genwf.html"><i class="fa fa-check"></i><b>3</b> General Workflow</a>
<ul>
<li class="chapter" data-level="3.1" data-path="genwf.html"><a href="genwf.html#incoming-candidates-for-digitization"><i class="fa fa-check"></i><b>3.1</b> Incoming candidates for digitization</a></li>
<li class="chapter" data-level="3.2" data-path="genwf.html"><a href="genwf.html#selecting-a-new-project"><i class="fa fa-check"></i><b>3.2</b> Selecting a new project</a></li>
<li class="chapter" data-level="3.3" data-path="genwf.html"><a href="genwf.html#supply-list"><i class="fa fa-check"></i><b>3.3</b> Supply list</a></li>
<li class="chapter" data-level="3.4" data-path="genwf.html"><a href="genwf.html#general-workflow-outline"><i class="fa fa-check"></i><b>3.4</b> General workflow outline</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="genwf.html"><a href="genwf.html#read-the-publication"><i class="fa fa-check"></i><b>3.4.1</b> 1. Read the publication</a></li>
<li class="chapter" data-level="3.4.2" data-path="genwf.html"><a href="genwf.html#sketch-an-outline-of-the-ipm"><i class="fa fa-check"></i><b>3.4.2</b> 2. Sketch an outline of the IPM</a></li>
<li class="chapter" data-level="3.4.3" data-path="genwf.html"><a href="genwf.html#list-the-equations-and-parameters-needed-to-recreate-the-ipm"><i class="fa fa-check"></i><b>3.4.3</b> 3. List the equations and parameters needed to recreate the IPM</a></li>
<li class="chapter" data-level="3.4.4" data-path="genwf.html"><a href="genwf.html#take-inventory"><i class="fa fa-check"></i><b>3.4.4</b> 4. Take inventory</a></li>
<li class="chapter" data-level="3.4.5" data-path="genwf.html"><a href="genwf.html#create-a-new-r-project"><i class="fa fa-check"></i><b>3.4.5</b> 5. Create a new R project</a></li>
<li class="chapter" data-level="3.4.6" data-path="genwf.html"><a href="genwf.html#script-01_dataformatting.r"><i class="fa fa-check"></i><b>3.4.6</b> 6. Script: 01_DataFormatting.R</a></li>
<li class="chapter" data-level="3.4.7" data-path="genwf.html"><a href="genwf.html#script-02_plotrawdata.r"><i class="fa fa-check"></i><b>3.4.7</b> 7. Script: 02_PlotRawData.R</a></li>
<li class="chapter" data-level="3.4.8" data-path="genwf.html"><a href="genwf.html#script-03_vitalratemodels.r"><i class="fa fa-check"></i><b>3.4.8</b> 8. Script: 03_VitalRateModels.R</a></li>
<li class="chapter" data-level="3.4.9" data-path="genwf.html"><a href="genwf.html#script-04_ipmscratch.r"><i class="fa fa-check"></i><b>3.4.9</b> 9. Script: 04_IPMScratch.R</a></li>
<li class="chapter" data-level="3.4.10" data-path="genwf.html"><a href="genwf.html#script-05_ipmr.r"><i class="fa fa-check"></i><b>3.4.10</b> 10. Script: 05_ipmr.R</a></li>
<li class="chapter" data-level="3.4.11" data-path="genwf.html"><a href="genwf.html#script-06_padrino.r"><i class="fa fa-check"></i><b>3.4.11</b> 11. Script: 06_PADRINO.R</a></li>
<li class="chapter" data-level="3.4.12" data-path="genwf.html"><a href="genwf.html#final-steps-of-digitization"><i class="fa fa-check"></i><b>3.4.12</b> 12. Final steps of digitization</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="genwf.html"><a href="genwf.html#why-do-we-construct-the-ipm-twice"><i class="fa fa-check"></i><b>3.5</b> Why do we construct the IPM twice?</a></li>
<li class="chapter" data-level="3.6" data-path="genwf.html"><a href="genwf.html#useful-links"><i class="fa fa-check"></i><b>3.6</b> Useful links</a></li>
</ul></li>
<li class="part"><span><b>II Adler Dataset Example</b></span></li>
<li class="chapter" data-level="4" data-path="adwf.html"><a href="adwf.html"><i class="fa fa-check"></i><b>4</b> Adler Dataset: Example of Workflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="adwf.html"><a href="adwf.html#introduction-to-the-adler-dataset"><i class="fa fa-check"></i><b>4.1</b> Introduction to the Adler dataset</a></li>
<li class="chapter" data-level="4.2" data-path="adwf.html"><a href="adwf.html#publications-featuring-the-adler-dataset"><i class="fa fa-check"></i><b>4.2</b> Publications featuring the Adler dataset</a></li>
<li class="chapter" data-level="4.3" data-path="adwf.html"><a href="adwf.html#planttracker"><i class="fa fa-check"></i><b>4.3</b> plantTracker</a></li>
<li class="chapter" data-level="4.4" data-path="adwf.html"><a href="adwf.html#workflow-with-example-dataset"><i class="fa fa-check"></i><b>4.4</b> Workflow with example dataset</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="adwf.html"><a href="adwf.html#reading-the-publications"><i class="fa fa-check"></i><b>4.4.1</b> 1. Reading the publications</a></li>
<li class="chapter" data-level="4.4.2" data-path="adwf.html"><a href="adwf.html#sketching-an-outline-of-the-ipm"><i class="fa fa-check"></i><b>4.4.2</b> 2. Sketching an outline of the IPM</a></li>
<li class="chapter" data-level="4.4.3" data-path="adwf.html"><a href="adwf.html#making-the-parameter-shopping-list"><i class="fa fa-check"></i><b>4.4.3</b> 3. Making the parameter ‚Äúshopping list‚Äù</a></li>
<li class="chapter" data-level="4.4.4" data-path="adwf.html"><a href="adwf.html#taking-inventory"><i class="fa fa-check"></i><b>4.4.4</b> 4. Taking inventory</a></li>
<li class="chapter" data-level="4.4.5" data-path="adwf.html"><a href="adwf.html#creating-a-new-r-project"><i class="fa fa-check"></i><b>4.4.5</b> 5. Creating a new R project</a></li>
<li class="chapter" data-level="4.4.6" data-path="adwf.html"><a href="adwf.html#data-formatting"><i class="fa fa-check"></i><b>4.4.6</b> 6. Data formatting</a></li>
<li class="chapter" data-level="4.4.7" data-path="adwf.html"><a href="adwf.html#plotting-the-raw-data"><i class="fa fa-check"></i><b>4.4.7</b> 7. Plotting the raw data</a></li>
<li class="chapter" data-level="4.4.8" data-path="adwf.html"><a href="adwf.html#fitting-vital-rate-models-for-the-mean-ipm"><i class="fa fa-check"></i><b>4.4.8</b> 8. Fitting vital rate models for the mean IPM</a></li>
<li class="chapter" data-level="4.4.9" data-path="adwf.html"><a href="adwf.html#buildipm4"><i class="fa fa-check"></i><b>4.4.9</b> 9. Building the IPM from scratch</a></li>
<li class="chapter" data-level="4.4.10" data-path="adwf.html"><a href="adwf.html#ipmr4"><i class="fa fa-check"></i><b>4.4.10</b> 10. Building the IPM with <code>ipmr</code></a></li>
<li class="chapter" data-level="4.4.11" data-path="adwf.html"><a href="adwf.html#populating-the-padrino-database-template"><i class="fa fa-check"></i><b>4.4.11</b> 11. Populating the PADRINO database template</a></li>
<li class="chapter" data-level="4.4.12" data-path="adwf.html"><a href="adwf.html#finishing-up-the-digitization-project"><i class="fa fa-check"></i><b>4.4.12</b> 12. Finishing up the digitization project</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adex.html"><a href="adex.html"><i class="fa fa-check"></i><b>5</b> Adler Dataset: Extensions to the Mean IPM</a>
<ul>
<li class="chapter" data-level="5.1" data-path="adex.html"><a href="adex.html#exploring-our-options"><i class="fa fa-check"></i><b>5.1</b> Exploring our options</a></li>
<li class="chapter" data-level="5.2" data-path="adex.html"><a href="adex.html#plotting-by-year-x-treatment"><i class="fa fa-check"></i><b>5.2</b> Plotting by year x treatment</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="adyr.html"><a href="adyr.html"><i class="fa fa-check"></i><b>6</b> Adler Dataset: Extensions to the Mean IPM - Incorporating Year</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="adyr.html"><a href="adyr.html#making-the-parameter-shopping-list-1"><i class="fa fa-check"></i><b>6.0.1</b> 3. Making the parameter ‚Äúshopping list‚Äù</a></li>
<li class="chapter" data-level="6.0.2" data-path="adyr.html"><a href="adyr.html#creating-new-folders-in-the-r-project"><i class="fa fa-check"></i><b>6.0.2</b> 5. Creating new folders in the R project</a></li>
<li class="chapter" data-level="6.0.3" data-path="adyr.html"><a href="adyr.html#data-formatting-1"><i class="fa fa-check"></i><b>6.0.3</b> 6. Data formatting</a></li>
<li class="chapter" data-level="6.0.4" data-path="adyr.html"><a href="adyr.html#plotting-the-raw-data-by-year"><i class="fa fa-check"></i><b>6.0.4</b> 7. Plotting the raw data by year</a></li>
<li class="chapter" data-level="6.0.5" data-path="adyr.html"><a href="adyr.html#fitting-vital-rate-models-with-the-random-effect-of-year"><i class="fa fa-check"></i><b>6.0.5</b> 8. Fitting vital rate models with the random effect of year</a></li>
<li class="chapter" data-level="6.0.6" data-path="adyr.html"><a href="adyr.html#building-the-year-specific-ipms-from-scratch"><i class="fa fa-check"></i><b>6.0.6</b> 9. Building the year-specific IPMs from scratch</a></li>
<li class="chapter" data-level="6.0.7" data-path="adyr.html"><a href="adyr.html#building-the-year-specific-ipms-with-ipmr"><i class="fa fa-check"></i><b>6.0.7</b> 10. Building the year-specific IPMs with <code>ipmr</code></a></li>
<li class="chapter" data-level="6.0.8" data-path="adyr.html"><a href="adyr.html#populating-the-padrino-database-template-1"><i class="fa fa-check"></i><b>6.0.8</b> 11. Populating the PADRINO database template</a></li>
<li class="chapter" data-level="6.0.9" data-path="adyr.html"><a href="adyr.html#finishing-up-the-digitization-project-1"><i class="fa fa-check"></i><b>6.0.9</b> 12. Finishing up the digitization project</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RUPDemo Digitization Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adyr" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Adler Dataset: Extensions to the Mean IPM - Incorporating Year<a href="adyr.html#adyr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we will introduce the effect of year into the vital rate models we fit in Chapter 4 for the mean IPM. We will build from Chapters 4 and 5 to continue exploring the data at the year-specific level, re-fit the vital rate models, and parameterize 13 new IPMs. We will then compare the lambda values of the year-specific IPMs to the lambda of the mean IPM.</p>
<p>As discussed in Chapter <a href="adex.html#adex">5</a>, this chapter will roughly follow the same workflow as Chapter 4, but I will not spend time reiterating the same things I detailed in Chapter 4. Therefore, a familiarity with the contents of Chapter <a href="genwf.html#genwf">3</a> is necessary to follow along with this chapter!</p>
<p>We will start by jumping to step 3, to discuss how our vital rate models are impacted when we consider the effect of year.</p>
<div id="making-the-parameter-shopping-list-1" class="section level3 hasAnchor" number="6.0.1">
<h3><span class="header-section-number">6.0.1</span> 3. Making the parameter ‚Äúshopping list‚Äù<a href="adyr.html#making-the-parameter-shopping-list-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One approach to incorporating the effect of year on our vital rates is to use a random effect of year in the vital rate models. Introducing the random effect of year to our vital rate models modifies how we notate the models, and greatly expands our parameter ‚Äúshopping list,‚Äù but it does not change the basic structure of the model. The result of this approach is that we can add all 13 IPMs to the PADRINO database under a single IPM ID, utilizing the <code>_yr</code> suffix functionality.</p>
<p>Another approach is to divide the dataset into 13 subsets, one for each year transition, and then fit vital rate models to each subset independently. In this approach, it is possible to fit models with different expressions for each year. When we add these IPMs to PADRINO, we would need a unique IPM ID for each year.</p>
<p>There are benefits and drawbacks of both approaches, and which approach you choose will depend on the data you are working with. For very large datasets with many more than 100 observations per year, fitting unique models for each year might make more sense than simply incorporating the random effect of year into the mean model. Alternatively, fitting unique models for each year may not make any difference if the best fitting models for each year follow the same model formula. In theory, you should test out both approaches with any dataset which has sufficient data, and compare the fit of the resulting models to choose how to proceed.</p>
<p>For the sake of simplicity, we will explore the first approach in this chapter. In Chapter 7, we will compare both approaches while incorporating the effect of treatment, as it is easier to keep track of the different models when there are fewer levels to model independently. Let‚Äôs go through each vital rate and update our shopping list accordingly for the models which consider the random effect of year in the model.</p>
<div id="survival-model-2" class="section level4 hasAnchor" number="6.0.1.1">
<h4><span class="header-section-number">6.0.1.1</span> Survival model<a href="adyr.html#survival-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In mathematical notation, the subscript on the model terms has an added <span class="math inline">\(_{yr}\)</span> component:</p>
<p><span class="math display">\[Logit(s_{yr}(z)) = \beta_{s0,yr} + \beta_{s1,yr} * z\]</span>
The <span class="math inline">\(_{yr}\)</span> subscript tells us that we will have unique values for the intercept and slope for each year, resulting in a different output each year (but the model expression stays the same).</p>
<p>In R, the model formula becomes:</p>
<pre><code>glmer( survives_t1 ~ size_t0 + ( size_t0 | Year ), data = survival_df, family = binomial )</code></pre>
<p>The output of this model will now have different estimates of the slope and intercept for each year.</p>
<p>In ipmr, we similarly append the <code>_yr</code> suffix to our model terms:</p>
<pre><code>s_yr = 1 / ( 1 + exp( -( beta_s0_yr + beta_s1_yr * size_0 ) ) )</code></pre>
<p>Now, instead of only needing to estimate two parameter values, we will need to extract 26 parameter values from our model, one slope and one intercept for each year. We can calculate these values by subtracting the random effects (from <code>ranef()</code>) from the fixed effects (from <code>fixef()</code>) for each year, or by simply using the <code>coef()</code> function.</p>
</div>
<div id="growth-model-1" class="section level4 hasAnchor" number="6.0.1.2">
<h4><span class="header-section-number">6.0.1.2</span> Growth model<a href="adyr.html#growth-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Similarly to the survival model, we add <span class="math inline">\(_{yr}\)</span> to some of the model terms:</p>
<p><span class="math display">\[G_{yr}(z&#39;, z) = f_{g}(z&#39;, \mu_{g,yr}, \sigma_{g})\]</span>
<span class="math display">\[\mu_{g,yr} = \beta_{g0,yr} + \beta_{g1,yr} * z\]</span>
<span class="math display">\[ \sigma_{g} = \sqrt{( a * e^{( b * z )} )}\]</span>
Note that the function <span class="math inline">\(f_{g}\)</span> does not get the <span class="math inline">\(_{yr}\)</span> subscript appended, as this is the probability density function describing the size of the individual at time t1, which is the same function for each year. <span class="math inline">\(G_{yr}(z&#39;, z)\)</span> gets the <span class="math inline">\(_{yr}\)</span> subscript to describe that the input to the <span class="math inline">\(f_{g}\)</span> function is dependent on year. Additionally, the growth variance model will be based on the aggregated data; there are no year-specific values.</p>
<p>In R, the model formulas become:</p>
<pre><code>lmer( size_t1 ~ size_t0 + ( size_t0 | Year ), data = growth_df )
nls( y ~ a * exp( b * x ), start = list( a = 1, b = 0 ) )</code></pre>
<p>Note that the model describing the variance of the growth model has not changed. As with the survival model, we will be able to extract values for the slope and intercept of the growth model at each year.</p>
<p>In ipmr, we similarly append the <code>_yr</code> suffix to the relevant model terms:</p>
<pre><code>g_yr = Norm( mu_g_yr, sigma_g )
mu_g_yr = beta_g0_yr + beta_g1_yr * size_0
sigma_g = sqrt( a * exp( b * size_0 ) )</code></pre>
<p>As in the survival model, we will now need to extract 13 estimates for each beta parameter, one for each yearly transition.</p>
</div>
<div id="recruitment-model-2" class="section level4 hasAnchor" number="6.0.1.3">
<h4><span class="header-section-number">6.0.1.3</span> Recruitment model<a href="adyr.html#recruitment-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the recruitment model, we will also add the <span class="math inline">\(_{yr}\)</span> subscript to some of model terms, in this case just the per-capita recruitment rate:
<span class="math display">\[F_{yr}(z&#39;) = \beta_{f,yr} * r_{d}(z&#39;)\]</span>
<span class="math display">\[r_{d}(z&#39;) = f_{r_{d}}(z&#39;, \mu_{r_{d}}, \sigma_{r_{d}})\]</span></p>
<p>In R, we will write the model as:</p>
<pre><code>glmer.nb( NRquad ~ ( 1 | Year ), data = recr_df )</code></pre>
<p>For now, we will actually ignore this model. The year-specific estimates corresponding to each <span class="math inline">\(\beta_{f,yr}\)</span> will be calculated from the raw data. We will also calculate the values for the mean and standard deviation of recruitment size from the aggregated raw data.</p>
<p>In ipmr, we will again append the <code>_yr</code> suffix the model term referring to the year-specific per-capita recruitment rate, but not to the other parameters:</p>
<pre><code>fy_yr = beta_f_yr * r_d
r_d = Norm( recr_sz, recr_sd )</code></pre>
<p>We therefore have 13 values of the year-specific per-capita recruitment rate and two values describing the size of recruits that we will need to calculate.</p>
</div>
<div id="other-parameters-1" class="section level4 hasAnchor" number="6.0.1.4">
<h4><span class="header-section-number">6.0.1.4</span> Other parameters<a href="adyr.html#other-parameters-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As with our mean model, we will need to define the minimum and maximum sizes over which to integrate, and the number of bins that ipmr will use to solve the integral. We will use 200 bins for all of our IPMs and the minimum and maximum sizes will be constant across all years.</p>
</div>
</div>
<div id="creating-new-folders-in-the-r-project" class="section level3 hasAnchor" number="6.0.2">
<h3><span class="header-section-number">6.0.2</span> 5. Creating new folders in the R project<a href="adyr.html#creating-new-folders-in-the-r-project" class="anchor-section" aria-label="Anchor link to header"></a></h3>
Since we are building these new IPMs from the same dataset we used to parameterize the mean IPM for <em>Bouteloua gracilis</em>, we should keep all of our files contained within the same R project. We want to make sure we keep our files organized, however, so we will just create some new folders named ‚ÄúBou_gra_yr‚Äù to differentiate the two workflows. The R project should look like this:
<center>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<tbody>
<tr style="border-top: 2px solid grey;">
<td style="border-top: 2px solid grey; text-align: left;">
üìÅ Adler_Colorado
</td>
<td style="border-top: 2px solid grey; text-align: left;">
</td>
<td style="border-top: 2px solid grey; text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">üÖÅ</span> Adler_Colorado.Rproj
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ data
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ Bou_gra_yr
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ R
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ Bou_gra_yr
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ results
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">
</td>
<td style="border-bottom: 2px solid grey; text-align: left;">
</td>
<td style="border-bottom: 2px solid grey; text-align: left;">
üìÅ Bou_gra_yr
</td>
</tr>
</tbody>
</table>
</center>
</div>
<div id="data-formatting-1" class="section level3 hasAnchor" number="6.0.3">
<h3><span class="header-section-number">6.0.3</span> 6. Data formatting<a href="adyr.html#data-formatting-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the ‚Äúdata/Bou_gra‚Äù subfolder, we already have formatted and cleaned data that we want to work with. We can either keep these files where they are and load them directly into the script from that subfolder, or we can copy and paste the files into the ‚Äúdata/Bou_gra_yr‚Äù subfolder. Either way, we should create our ‚Äúnotes‚Äù text document and indicate that we are using the already-formatted data from the previous workflow.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="adyr.html#cb130-1" aria-hidden="true" tabindex="-1"></a>grow <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="st">&quot;https://raw.githubusercontent.com/aspen1030/RUPDemo/main/growth_df_mod.csv&quot;</span> )</span>
<span id="cb130-2"><a href="adyr.html#cb130-2" aria-hidden="true" tabindex="-1"></a>surv <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="st">&quot;https://raw.githubusercontent.com/aspen1030/RUPDemo/main/survival_df_mod.csv&quot;</span> )</span>
<span id="cb130-3"><a href="adyr.html#cb130-3" aria-hidden="true" tabindex="-1"></a>recr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="st">&quot;https://raw.githubusercontent.com/aspen1030/RUPDemo/main/recruitment_df_mod.csv&quot;</span> )</span>
<span id="cb130-4"><a href="adyr.html#cb130-4" aria-hidden="true" tabindex="-1"></a>Bou_gra <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( <span class="st">&quot;https://raw.githubusercontent.com/aspen1030/RUPDemo/main/Bou_gra_clean.csv&quot;</span> )</span></code></pre></div>
</div>
<div id="plotting-the-raw-data-by-year" class="section level3 hasAnchor" number="6.0.4">
<h3><span class="header-section-number">6.0.4</span> 7. Plotting the raw data by year<a href="adyr.html#plotting-the-raw-data-by-year" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since there is no need to do any new formatting to the data, we can call our data plotting script ‚Äú01_Plotting.R‚Äù as it is our first script in this workflow.</p>
<p>In the previous workflow, we began by plotting size at t0 and size at t1 as histograms to examine the distributions of the size data. We should now do the same for each year. Consider a plot of size at t0 for the year 2000 and a plot of size at t1 for the year 2000. It might be tempting to think that we could just plot size at t0 for each year, because size at t1 for the year 2000 might be equivalent to size at t0 for the year 2001. However, this is incorrect; a plot of size at t1 for the year 2000 will have fewer individuals than both plots of size at t0 for the years 2000 and 2001, as some of the individuals will die after the 2000 census and new individuals will be recruited in 2001 which were not present in the 2000 census. Therefore, we should prepare histograms of both size at t0 and size at t1 for all years. We will go ahead and skip directly to plotting the log-transformed sizes.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="adyr.html#cb131-1" aria-hidden="true" tabindex="-1"></a>Bou_gra<span class="sc">$</span>logsize_t1 <span class="ot">&lt;-</span> <span class="fu">log</span>( Bou_gra<span class="sc">$</span>size_tplus1 )</span>
<span id="cb131-2"><a href="adyr.html#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="adyr.html#cb131-3" aria-hidden="true" tabindex="-1"></a>Bou_gra_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>( Bou_gra, <span class="at">cols =</span> <span class="fu">c</span>( logsize, logsize_t1 ), <span class="at">names_to =</span> <span class="st">&quot;size&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;size_value&quot;</span> )</span>
<span id="cb131-4"><a href="adyr.html#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="adyr.html#cb131-5" aria-hidden="true" tabindex="-1"></a>Bou_gra_long<span class="sc">$</span>size     <span class="ot">&lt;-</span> <span class="fu">as.factor</span>( Bou_gra_long<span class="sc">$</span>size )</span>
<span id="cb131-6"><a href="adyr.html#cb131-6" aria-hidden="true" tabindex="-1"></a>Bou_gra_long<span class="sc">$</span>Year_fac <span class="ot">&lt;-</span> <span class="fu">as.factor</span>( Bou_gra_long<span class="sc">$</span>Year )</span>
<span id="cb131-7"><a href="adyr.html#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="adyr.html#cb131-8" aria-hidden="true" tabindex="-1"></a>size_labs <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&quot;at time t0&quot;</span>, <span class="st">&quot;at time t1&quot;</span> )</span>
<span id="cb131-9"><a href="adyr.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(size_labs) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&quot;logsize&quot;</span>, <span class="st">&quot;logsize_t1&quot;</span> )</span>
<span id="cb131-10"><a href="adyr.html#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="adyr.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/histograms.png&#39;, width = 6, height = 13, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb131-12"><a href="adyr.html#cb131-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-13"><a href="adyr.html#cb131-13" aria-hidden="true" tabindex="-1"></a>Bou_gra_long <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( <span class="fu">aes</span>( <span class="at">x =</span> size_value ) ) <span class="sc">+</span></span>
<span id="cb131-14"><a href="adyr.html#cb131-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>( <span class="at">binwidth =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb131-15"><a href="adyr.html#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>( Year_fac <span class="sc">~</span> size, </span>
<span id="cb131-16"><a href="adyr.html#cb131-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb131-17"><a href="adyr.html#cb131-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">labeller =</span> <span class="fu">labeller</span>( <span class="at">size =</span> size_labs ) ) <span class="sc">+</span></span>
<span id="cb131-18"><a href="adyr.html#cb131-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;log( size )&quot;</span>,</span>
<span id="cb131-19"><a href="adyr.html#cb131-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span> )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-62-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="adyr.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>From this plot, we can see that the distributions of size shift from time t0 to time t1 in all years, particularly with regards to the smallest individuals. A large loss in these individuals from time t0 to time t1 without noticeable increases in the middle size classes indicates high seedling mortality in a given year, which is most pronounced in 1999-2007. In some years, we see a shift in the main distribution from smaller sizes in time t0 to slightly larger sizes in time t1, which we would expect, as this suggests that individuals are indeed growing. Overall, since there do seem to be differences in the patterns between years, so modeling the data with the random effect of year seems like a reasonable choice. Additionally, the lower and upper bounds of size seem quite consistent across all years, so keeping the limits of integration constant across all years is also a reasonable choice.</p>
<p>Let‚Äôs now plot the survival data by year. We must first setup a function which bins the survival data by size for each year, so that we can visualize the data as probabilities of survival for a given size class. We then apply the function across 13 years to create a list that we can plot faceted by year.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="adyr.html#cb133-1" aria-hidden="true" tabindex="-1"></a>df_binned_prop_year <span class="ot">&lt;-</span> <span class="cf">function</span>( ii, df_in, n_bins, siz_var, rsp_var, years ){</span>
<span id="cb133-2"><a href="adyr.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-3"><a href="adyr.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sub-selection of data</span></span>
<span id="cb133-4"><a href="adyr.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  df   <span class="ot">&lt;-</span> <span class="fu">subset</span>( df_in, Year <span class="sc">==</span> years<span class="sc">$</span>Year[ii] )</span>
<span id="cb133-5"><a href="adyr.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-6"><a href="adyr.html#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">nrow</span>( df ) <span class="sc">==</span> <span class="dv">0</span> ) <span class="fu">return</span>( <span class="cn">NULL</span> )</span>
<span id="cb133-7"><a href="adyr.html#cb133-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-8"><a href="adyr.html#cb133-8" aria-hidden="true" tabindex="-1"></a>  size_var <span class="ot">&lt;-</span> <span class="fu">deparse</span>( <span class="fu">substitute</span>( siz_var ) )</span>
<span id="cb133-9"><a href="adyr.html#cb133-9" aria-hidden="true" tabindex="-1"></a>  resp_var <span class="ot">&lt;-</span> <span class="fu">deparse</span>( <span class="fu">substitute</span>( rsp_var ) )</span>
<span id="cb133-10"><a href="adyr.html#cb133-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-11"><a href="adyr.html#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># binned survival probabilities</span></span>
<span id="cb133-12"><a href="adyr.html#cb133-12" aria-hidden="true" tabindex="-1"></a>  h    <span class="ot">&lt;-</span> ( <span class="fu">max</span>(df[,size_var], <span class="at">na.rm =</span> T ) <span class="sc">-</span> <span class="fu">min</span>( df[,size_var], <span class="at">na.rm =</span> T ) ) <span class="sc">/</span> n_bins</span>
<span id="cb133-13"><a href="adyr.html#cb133-13" aria-hidden="true" tabindex="-1"></a>  lwr  <span class="ot">&lt;-</span> <span class="fu">min</span>( df[,size_var], <span class="at">na.rm =</span> T ) <span class="sc">+</span> ( h <span class="sc">*</span> <span class="fu">c</span>( <span class="dv">0</span><span class="sc">:</span>( n_bins <span class="sc">-</span> <span class="dv">1</span> ) ) )</span>
<span id="cb133-14"><a href="adyr.html#cb133-14" aria-hidden="true" tabindex="-1"></a>  upr  <span class="ot">&lt;-</span> lwr <span class="sc">+</span> h</span>
<span id="cb133-15"><a href="adyr.html#cb133-15" aria-hidden="true" tabindex="-1"></a>  mid  <span class="ot">&lt;-</span> lwr <span class="sc">+</span> ( <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> h )</span>
<span id="cb133-16"><a href="adyr.html#cb133-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-17"><a href="adyr.html#cb133-17" aria-hidden="true" tabindex="-1"></a>  binned_prop <span class="ot">&lt;-</span> <span class="cf">function</span>( lwr_x, upr_x, response ){</span>
<span id="cb133-18"><a href="adyr.html#cb133-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-19"><a href="adyr.html#cb133-19" aria-hidden="true" tabindex="-1"></a>    id  <span class="ot">&lt;-</span> <span class="fu">which</span>( df[,size_var] <span class="sc">&gt;</span> lwr_x <span class="sc">&amp;</span> df[,size_var] <span class="sc">&lt;</span> upr_x ) </span>
<span id="cb133-20"><a href="adyr.html#cb133-20" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> df[id,]</span>
<span id="cb133-21"><a href="adyr.html#cb133-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-22"><a href="adyr.html#cb133-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( response <span class="sc">==</span> <span class="st">&#39;prob&#39;</span> ){   <span class="fu">return</span>( <span class="fu">sum</span>( tmp[,resp_var], <span class="at">na.rm =</span> T ) <span class="sc">/</span> <span class="fu">nrow</span>( tmp ) ) }</span>
<span id="cb133-23"><a href="adyr.html#cb133-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( response <span class="sc">==</span> <span class="st">&#39;n_size&#39;</span> ){ <span class="fu">return</span>( <span class="fu">nrow</span>( tmp ) ) }</span>
<span id="cb133-24"><a href="adyr.html#cb133-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-25"><a href="adyr.html#cb133-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-26"><a href="adyr.html#cb133-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-27"><a href="adyr.html#cb133-27" aria-hidden="true" tabindex="-1"></a>  y_binned <span class="ot">&lt;-</span> <span class="fu">Map</span>( binned_prop, lwr, upr, <span class="st">&#39;prob&#39;</span> ) <span class="sc">%&gt;%</span> unlist</span>
<span id="cb133-28"><a href="adyr.html#cb133-28" aria-hidden="true" tabindex="-1"></a>  x_binned <span class="ot">&lt;-</span> mid</span>
<span id="cb133-29"><a href="adyr.html#cb133-29" aria-hidden="true" tabindex="-1"></a>  y_n_size <span class="ot">&lt;-</span> <span class="fu">Map</span>( binned_prop, lwr, upr, <span class="st">&#39;n_size&#39;</span> ) <span class="sc">%&gt;%</span> unlist</span>
<span id="cb133-30"><a href="adyr.html#cb133-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-31"><a href="adyr.html#cb133-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output data frame</span></span>
<span id="cb133-32"><a href="adyr.html#cb133-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>( <span class="at">xx  =</span> x_binned, </span>
<span id="cb133-33"><a href="adyr.html#cb133-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">yy  =</span> y_binned,</span>
<span id="cb133-34"><a href="adyr.html#cb133-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">nn  =</span> y_n_size ) <span class="sc">%&gt;%</span> </span>
<span id="cb133-35"><a href="adyr.html#cb133-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>( <span class="fu">c</span>( size_var, resp_var, <span class="st">&#39;n_size&#39;</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb133-36"><a href="adyr.html#cb133-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">Year      =</span> years<span class="sc">$</span>Year[ii] )</span>
<span id="cb133-37"><a href="adyr.html#cb133-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-38"><a href="adyr.html#cb133-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-39"><a href="adyr.html#cb133-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-40"><a href="adyr.html#cb133-40" aria-hidden="true" tabindex="-1"></a>surv_yrs       <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Year =</span> surv<span class="sc">$</span>Year <span class="sc">%&gt;%</span> unique <span class="sc">%&gt;%</span> sort )</span>
<span id="cb133-41"><a href="adyr.html#cb133-41" aria-hidden="true" tabindex="-1"></a>surv_bin_yrs   <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, df_binned_prop_year, Bou_gra, <span class="dv">20</span>, </span>
<span id="cb133-42"><a href="adyr.html#cb133-42" aria-hidden="true" tabindex="-1"></a>                      logsize, survives_tplus1, surv_yrs )</span>
<span id="cb133-43"><a href="adyr.html#cb133-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-44"><a href="adyr.html#cb133-44" aria-hidden="true" tabindex="-1"></a>surv_yr_pan_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>( surv_bin_yrs ) <span class="sc">%&gt;%</span> </span>
<span id="cb133-45"><a href="adyr.html#cb133-45" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>( <span class="at">transition =</span> <span class="fu">paste</span>( <span class="fu">paste0</span>( Year ),</span>
<span id="cb133-46"><a href="adyr.html#cb133-46" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">substr</span>( <span class="fu">paste0</span>( Year <span class="sc">+</span> <span class="dv">1</span> ), <span class="dv">3</span>, <span class="dv">4</span> ),</span>
<span id="cb133-47"><a href="adyr.html#cb133-47" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">sep =</span> <span class="st">&#39;-&#39;</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb133-48"><a href="adyr.html#cb133-48" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>( <span class="at">year       =</span> <span class="fu">as.integer</span>( Year <span class="sc">-</span> <span class="dv">1996</span> ) )</span>
<span id="cb133-49"><a href="adyr.html#cb133-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-50"><a href="adyr.html#cb133-50" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/survival_binned_yr.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb133-51"><a href="adyr.html#cb133-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-52"><a href="adyr.html#cb133-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data   =</span> surv_yr_pan_df, </span>
<span id="cb133-53"><a href="adyr.html#cb133-53" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>( <span class="at">x =</span> logsize, </span>
<span id="cb133-54"><a href="adyr.html#cb133-54" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> survives_tplus1 ) ) <span class="sc">+</span></span>
<span id="cb133-55"><a href="adyr.html#cb133-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb133-56"><a href="adyr.html#cb133-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">pch   =</span> <span class="dv">16</span>,</span>
<span id="cb133-57"><a href="adyr.html#cb133-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">size  =</span> <span class="dv">1</span>,</span>
<span id="cb133-58"><a href="adyr.html#cb133-58" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&#39;red&#39;</span> ) <span class="sc">+</span></span>
<span id="cb133-59"><a href="adyr.html#cb133-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>( <span class="at">breaks =</span> <span class="fu">c</span>( <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span> ) ) <span class="sc">+</span></span>
<span id="cb133-60"><a href="adyr.html#cb133-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split in panels</span></span>
<span id="cb133-61"><a href="adyr.html#cb133-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( .<span class="sc">~</span> transition, <span class="at">nrow =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb133-62"><a href="adyr.html#cb133-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>( ) <span class="sc">+</span></span>
<span id="cb133-63"><a href="adyr.html#cb133-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">axis.text =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">8</span> ),</span>
<span id="cb133-64"><a href="adyr.html#cb133-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">title     =</span> <span class="fu">element_text</span>( <span class="at">size =</span> <span class="dv">10</span> ),</span>
<span id="cb133-65"><a href="adyr.html#cb133-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.y  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">5</span>,</span>
<span id="cb133-66"><a href="adyr.html#cb133-66" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb133-67"><a href="adyr.html#cb133-67" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb133-68"><a href="adyr.html#cb133-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.x  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">5</span>,</span>
<span id="cb133-69"><a href="adyr.html#cb133-69" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb133-70"><a href="adyr.html#cb133-70" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb133-71"><a href="adyr.html#cb133-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.switch.pad.wrap =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ),</span>
<span id="cb133-72"><a href="adyr.html#cb133-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">panel.spacing         =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ) ) <span class="sc">+</span></span>
<span id="cb133-73"><a href="adyr.html#cb133-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;log(size)&#39;</span>[t0] ),</span>
<span id="cb133-74"><a href="adyr.html#cb133-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;Survival to time t1&#39;</span> ) )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-63-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="adyr.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>As always happens in demographic data, the relationship between survival probability at time t1 and size a time t0 is variable through years, further justifying our choice to create an IPM for each year.</p>
<p>Next, we should plot the growth data faceted by year.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="adyr.html#cb135-1" aria-hidden="true" tabindex="-1"></a>grow_yr_pan_df <span class="ot">&lt;-</span> grow <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="adyr.html#cb135-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>( <span class="at">transition =</span> <span class="fu">paste</span>( <span class="fu">paste0</span>( Year ),</span>
<span id="cb135-3"><a href="adyr.html#cb135-3" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">substr</span>( <span class="fu">paste0</span>( Year <span class="sc">+</span> <span class="dv">1</span> ), <span class="dv">3</span>, <span class="dv">4</span> ),</span>
<span id="cb135-4"><a href="adyr.html#cb135-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">sep =</span> <span class="st">&#39;-&#39;</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-5"><a href="adyr.html#cb135-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>( <span class="at">year       =</span> <span class="fu">as.integer</span>( Year <span class="sc">-</span> <span class="dv">1996</span> ) )</span>
<span id="cb135-6"><a href="adyr.html#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="adyr.html#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/growth_yr.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb135-8"><a href="adyr.html#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="adyr.html#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data  =</span> grow_yr_pan_df, <span class="fu">aes</span>( <span class="at">x =</span> logsize, <span class="at">y =</span> <span class="fu">log</span>( size_tplus1 ) ) ) <span class="sc">+</span></span>
<span id="cb135-10"><a href="adyr.html#cb135-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb135-11"><a href="adyr.html#cb135-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">pch   =</span> <span class="dv">16</span>,</span>
<span id="cb135-12"><a href="adyr.html#cb135-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">size  =</span> <span class="fl">0.7</span>,</span>
<span id="cb135-13"><a href="adyr.html#cb135-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&#39;red&#39;</span> ) <span class="sc">+</span></span>
<span id="cb135-14"><a href="adyr.html#cb135-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split in panels</span></span>
<span id="cb135-15"><a href="adyr.html#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( .<span class="sc">~</span> transition, <span class="at">nrow =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb135-16"><a href="adyr.html#cb135-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>( ) <span class="sc">+</span></span>
<span id="cb135-17"><a href="adyr.html#cb135-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">axis.text     =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span> ),</span>
<span id="cb135-18"><a href="adyr.html#cb135-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">title         =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">10</span> ),</span>
<span id="cb135-19"><a href="adyr.html#cb135-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.y  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span>,</span>
<span id="cb135-20"><a href="adyr.html#cb135-20" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb135-21"><a href="adyr.html#cb135-21" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb135-22"><a href="adyr.html#cb135-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.x  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span>,</span>
<span id="cb135-23"><a href="adyr.html#cb135-23" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb135-24"><a href="adyr.html#cb135-24" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb135-25"><a href="adyr.html#cb135-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.switch.pad.wrap =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ),</span>
<span id="cb135-26"><a href="adyr.html#cb135-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">panel.spacing         =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ) ) <span class="sc">+</span></span>
<span id="cb135-27"><a href="adyr.html#cb135-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size )&#39;</span>[t0] ),</span>
<span id="cb135-28"><a href="adyr.html#cb135-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size )&#39;</span>[t1] ) )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-64-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="adyr.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>Here, we see the effect of transition year on the growth vital rate. Some transition years show less spread in the data (03-04) compared to others (01-02), and we can start to see how the different years might be modeled with different slopes and/or intercepts.</p>
<p>Now we can plot the recruitment data faceted by year. For visualiztion purposes, I‚Äôve filtered out the largest value (the single year where over 600 recruits were added to the dataset).</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="adyr.html#cb137-1" aria-hidden="true" tabindex="-1"></a>indiv_qd <span class="ot">&lt;-</span> surv <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="adyr.html#cb137-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>( Quad ) <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="adyr.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>( Year ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-4"><a href="adyr.html#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>( <span class="at">n_adults =</span> n ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-5"><a href="adyr.html#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">Year =</span> Year <span class="sc">+</span> <span class="dv">1</span> )</span>
<span id="cb137-6"><a href="adyr.html#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="adyr.html#cb137-7" aria-hidden="true" tabindex="-1"></a>repr_yr <span class="ot">&lt;-</span> indiv_qd <span class="sc">%&gt;%</span> </span>
<span id="cb137-8"><a href="adyr.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>( recr ) <span class="sc">%&gt;%</span></span>
<span id="cb137-9"><a href="adyr.html#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">repr_pc    =</span> NRquad <span class="sc">/</span> n_adults ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-10"><a href="adyr.html#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> Year <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-11"><a href="adyr.html#cb137-11" aria-hidden="true" tabindex="-1"></a>  drop_na</span></code></pre></div>
<pre><code>## Joining with `by = join_by(Quad, Year)`</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="adyr.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/recruit_yr.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb139-2"><a href="adyr.html#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="adyr.html#cb139-3" aria-hidden="true" tabindex="-1"></a>repr_yr <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="adyr.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( NRquad <span class="sc">!=</span> <span class="fu">max</span>( repr_yr<span class="sc">$</span>NRquad ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="adyr.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( n_adults <span class="sc">!=</span> <span class="fu">max</span>( repr_yr<span class="sc">$</span>n_adults ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-6"><a href="adyr.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>( <span class="at">x =</span> n_adults, <span class="at">y =</span> NRquad ) ) <span class="sc">+</span></span>
<span id="cb139-7"><a href="adyr.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb139-8"><a href="adyr.html#cb139-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">pch   =</span> <span class="dv">16</span>,</span>
<span id="cb139-9"><a href="adyr.html#cb139-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">size  =</span> <span class="dv">1</span>,</span>
<span id="cb139-10"><a href="adyr.html#cb139-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&#39;red&#39;</span> ) <span class="sc">+</span></span>
<span id="cb139-11"><a href="adyr.html#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( .<span class="sc">~</span> Year, <span class="at">nrow =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb139-12"><a href="adyr.html#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>( ) <span class="sc">+</span></span>
<span id="cb139-13"><a href="adyr.html#cb139-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">axis.text     =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span> ),</span>
<span id="cb139-14"><a href="adyr.html#cb139-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">title         =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">10</span> ),</span>
<span id="cb139-15"><a href="adyr.html#cb139-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.y  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span>,</span>
<span id="cb139-16"><a href="adyr.html#cb139-16" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb139-17"><a href="adyr.html#cb139-17" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb139-18"><a href="adyr.html#cb139-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.text.x  =</span> <span class="fu">element_text</span>( <span class="at">size   =</span> <span class="dv">8</span>,</span>
<span id="cb139-19"><a href="adyr.html#cb139-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">margin =</span> <span class="fu">margin</span>( <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span id="cb139-20"><a href="adyr.html#cb139-20" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&#39;mm&#39;</span> ) ),</span>
<span id="cb139-21"><a href="adyr.html#cb139-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip.switch.pad.wrap =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ),</span>
<span id="cb139-22"><a href="adyr.html#cb139-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">panel.spacing         =</span> <span class="fu">unit</span>( <span class="st">&#39;0.5&#39;</span>, <span class="at">unit =</span> <span class="st">&#39;mm&#39;</span> ) ) <span class="sc">+</span></span>
<span id="cb139-23"><a href="adyr.html#cb139-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;Number of adults &#39;</span>[ t0] ),</span>
<span id="cb139-24"><a href="adyr.html#cb139-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;Number of recruits &#39;</span>[ t1] ) )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-65-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="adyr.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>As with the other vital rates, we see some differences between the years which we will incorporate into our IPM by taking a year-specific per-capita mean recruitment rate across all plots.</p>
<p>We should also take a moment to plot histograms of the recruit size data, so we can determine if we should take year-specific means and standard deviations of recruit size, or if we expect that taking the global mean and standard deviation would be sufficient.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="adyr.html#cb141-1" aria-hidden="true" tabindex="-1"></a>recSize <span class="ot">&lt;-</span> Bou_gra <span class="sc">%&gt;%</span> <span class="fu">subset</span>( recruit <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb141-2"><a href="adyr.html#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="adyr.html#cb141-3" aria-hidden="true" tabindex="-1"></a>recSize<span class="sc">$</span>Year_fac <span class="ot">&lt;-</span> <span class="fu">as.factor</span>( recSize<span class="sc">$</span>Year )</span>
<span id="cb141-4"><a href="adyr.html#cb141-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-5"><a href="adyr.html#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/recr_histograms.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb141-6"><a href="adyr.html#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="adyr.html#cb141-7" aria-hidden="true" tabindex="-1"></a>recSize <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( <span class="fu">aes</span>( <span class="at">x =</span> logsize ) ) <span class="sc">+</span></span>
<span id="cb141-8"><a href="adyr.html#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>( ) <span class="sc">+</span></span>
<span id="cb141-9"><a href="adyr.html#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( Year_fac <span class="sc">~</span> ., </span>
<span id="cb141-10"><a href="adyr.html#cb141-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb141-11"><a href="adyr.html#cb141-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow =</span> <span class="dv">4</span> ) <span class="sc">+</span></span>
<span id="cb141-12"><a href="adyr.html#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="fu">expression</span>(<span class="st">&#39;log( size )&#39;</span>[t0]),</span>
<span id="cb141-13"><a href="adyr.html#cb141-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span> )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-66-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="adyr.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>Note that I‚Äôve used the <code>"free_y"</code> option in <code>facet_wrap()</code> to allow the y-axis to be fitted to each panel individually, while the x-axis remains fixed across all panels. This ensures that we can actually compare the distributions across years, even though 2002 has an order of magnitude more recruits than any other year. While there is some variability in the distributions across the years, the majority of recruits enter the population at the minimum size and there doesn‚Äôt seem to be any particularly wild years. Keep in mind also that the sizes on the x-axis are log-transformed; we‚Äôre dealing with incredibly small individuals overall. While the differences may seem pronounced on this scale, it is important to keep in mind the biological scale of these individuals. An individual with log(size) around -10 has an area of 0.005 cm<span class="math inline">\(^2\)</span>, whereas an individual with log(size) of -6 has an area of 0.25 cm<span class="math inline">\(^2\)</span>. These are both very, very small plants; differences in size at this scale may very well be attributable to errors in how the plants were recorded on the paper maps or digitized. We will therefore keep the recruitment size parameters constant throughout all years.</p>
</div>
<div id="fitting-vital-rate-models-with-the-random-effect-of-year" class="section level3 hasAnchor" number="6.0.5">
<h3><span class="header-section-number">6.0.5</span> 8. Fitting vital rate models with the random effect of year<a href="adyr.html#fitting-vital-rate-models-with-the-random-effect-of-year" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we already wrote our model formulas in step 3, we are ready to jump right into fitting these models to the data.</p>
<div id="survival-model-3" class="section level4 hasAnchor" number="6.0.5.1">
<h4><span class="header-section-number">6.0.5.1</span> Survival model<a href="adyr.html#survival-model-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here is the model we wrote previously:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="adyr.html#cb143-1" aria-hidden="true" tabindex="-1"></a>surv_df      <span class="ot">&lt;-</span> surv <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="adyr.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">logarea =</span> <span class="fu">log</span>( basalArea_genet ) )</span>
<span id="cb143-3"><a href="adyr.html#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="adyr.html#cb143-4" aria-hidden="true" tabindex="-1"></a>su_mod_yr <span class="ot">&lt;-</span> <span class="fu">glmer</span>( survives_tplus1 <span class="sc">~</span> logarea <span class="sc">+</span> ( logarea <span class="sc">|</span> Year ), <span class="at">data =</span> surv_df, <span class="at">family =</span> binomial )</span></code></pre></div>
<p>Let‚Äôs plot the model over the data and check the model fit:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="adyr.html#cb144-1" aria-hidden="true" tabindex="-1"></a>ranef_su <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">coef</span>( su_mod_yr )[<span class="dv">1</span>] )</span>
<span id="cb144-2"><a href="adyr.html#cb144-2" aria-hidden="true" tabindex="-1"></a>years_v  <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span> )</span>
<span id="cb144-3"><a href="adyr.html#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="adyr.html#cb144-4" aria-hidden="true" tabindex="-1"></a>surv_yr_plots <span class="ot">&lt;-</span> <span class="cf">function</span>( i ){</span>
<span id="cb144-5"><a href="adyr.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  surv_temp   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>( surv_bin_yrs[[i]] )</span>
<span id="cb144-6"><a href="adyr.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  x_temp      <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="fu">min</span>( surv_temp<span class="sc">$</span>logsize, <span class="at">na.rm =</span> T ), </span>
<span id="cb144-7"><a href="adyr.html#cb144-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">max</span>( surv_temp<span class="sc">$</span>logsize, <span class="at">na.rm =</span> T ), </span>
<span id="cb144-8"><a href="adyr.html#cb144-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb144-9"><a href="adyr.html#cb144-9" aria-hidden="true" tabindex="-1"></a>  pred_temp   <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">inv.logit</span>( ranef_su[i,<span class="dv">1</span>] <span class="sc">+</span> ranef_su[i,<span class="dv">2</span>] <span class="sc">*</span> x_temp ) </span>
<span id="cb144-10"><a href="adyr.html#cb144-10" aria-hidden="true" tabindex="-1"></a>  pred_temp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">logarea =</span> x_temp, <span class="at">survives_tplus1 =</span> pred_temp )</span>
<span id="cb144-11"><a href="adyr.html#cb144-11" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> surv_temp <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb144-12"><a href="adyr.html#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> logsize, <span class="at">y =</span> survives_tplus1 ) ) <span class="sc">+</span></span>
<span id="cb144-13"><a href="adyr.html#cb144-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>( <span class="at">data =</span> pred_temp_df, <span class="fu">aes</span>( <span class="at">x     =</span> logarea,</span>
<span id="cb144-14"><a href="adyr.html#cb144-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y     =</span> survives_tplus1 ),</span>
<span id="cb144-15"><a href="adyr.html#cb144-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">color =</span> <span class="st">&#39;red&#39;</span>,</span>
<span id="cb144-16"><a href="adyr.html#cb144-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">lwd   =</span> <span class="dv">1</span>  ) <span class="sc">+</span></span>
<span id="cb144-17"><a href="adyr.html#cb144-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>( years_v[i] ),</span>
<span id="cb144-18"><a href="adyr.html#cb144-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size )&#39;</span>[t0] ),</span>
<span id="cb144-19"><a href="adyr.html#cb144-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;Survival probability  &#39;</span>[ t1] ) )</span>
<span id="cb144-20"><a href="adyr.html#cb144-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( i <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span> ) ){</span>
<span id="cb144-21"><a href="adyr.html#cb144-21" aria-hidden="true" tabindex="-1"></a>    temp_plot <span class="ot">&lt;-</span> temp_plot <span class="sc">+</span> <span class="fu">theme</span>( <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>( ) )</span>
<span id="cb144-22"><a href="adyr.html#cb144-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-23"><a href="adyr.html#cb144-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-24"><a href="adyr.html#cb144-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(temp_plot)</span>
<span id="cb144-25"><a href="adyr.html#cb144-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-26"><a href="adyr.html#cb144-26" aria-hidden="true" tabindex="-1"></a>surv_yrs <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, surv_yr_plots )</span>
<span id="cb144-27"><a href="adyr.html#cb144-27" aria-hidden="true" tabindex="-1"></a>surv_years <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>( surv_yrs ) <span class="sc">+</span> <span class="fu">plot_layout</span>( <span class="at">nrow =</span> <span class="dv">4</span> )</span>
<span id="cb144-28"><a href="adyr.html#cb144-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-29"><a href="adyr.html#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/survival_pred.png&#39;, width = 10, height = 8, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb144-30"><a href="adyr.html#cb144-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-31"><a href="adyr.html#cb144-31" aria-hidden="true" tabindex="-1"></a>surv_years</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-68-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="adyr.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>These plots show the year-specific models plotted over the binned data. Some years seem to be fit better than others, but overall the model describes the data fairly well.</p>
</div>
<div id="growth-model-2" class="section level4 hasAnchor" number="6.0.5.2">
<h4><span class="header-section-number">6.0.5.2</span> Growth model<a href="adyr.html#growth-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here is the first model that we wrote previously, describing the growth of individuals:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="adyr.html#cb146-1" aria-hidden="true" tabindex="-1"></a>grow_df      <span class="ot">&lt;-</span> grow <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="adyr.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">logarea_t0 =</span> <span class="fu">log</span>( basalArea_genet ),</span>
<span id="cb146-3"><a href="adyr.html#cb146-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">logarea_t1 =</span> <span class="fu">log</span>( size_tplus1 ) )</span>
<span id="cb146-4"><a href="adyr.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="adyr.html#cb146-5" aria-hidden="true" tabindex="-1"></a>gr_mod_yr <span class="ot">&lt;-</span> <span class="fu">lmer</span>( logarea_t1 <span class="sc">~</span> logarea_t0 <span class="sc">+</span> ( logarea_t0 <span class="sc">|</span> Year ), <span class="at">data =</span> grow_df )</span></code></pre></div>
<p>Let‚Äôs plot the model over the data and check the model fit:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="adyr.html#cb147-1" aria-hidden="true" tabindex="-1"></a>ranef_gr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">coef</span>( gr_mod_yr )[<span class="dv">1</span>] )</span>
<span id="cb147-2"><a href="adyr.html#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="adyr.html#cb147-3" aria-hidden="true" tabindex="-1"></a>grow_yr_plots <span class="ot">&lt;-</span> <span class="cf">function</span>( i ){</span>
<span id="cb147-4"><a href="adyr.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> grow_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Year <span class="sc">==</span> i ) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb147-5"><a href="adyr.html#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> logarea_t0, </span>
<span id="cb147-6"><a href="adyr.html#cb147-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> logarea_t1 ) ) <span class="sc">+</span></span>
<span id="cb147-7"><a href="adyr.html#cb147-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>( <span class="fu">aes</span>( <span class="at">intercept =</span> ranef_gr[<span class="fu">which</span>(<span class="fu">rownames</span>( ranef_gr ) <span class="sc">==</span> i ),<span class="dv">1</span>],</span>
<span id="cb147-8"><a href="adyr.html#cb147-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope     =</span> ranef_gr[<span class="fu">which</span>(<span class="fu">rownames</span>( ranef_gr ) <span class="sc">==</span> i ),<span class="dv">2</span>] ),</span>
<span id="cb147-9"><a href="adyr.html#cb147-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb147-10"><a href="adyr.html#cb147-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lwd   =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb147-11"><a href="adyr.html#cb147-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>( i ),</span>
<span id="cb147-12"><a href="adyr.html#cb147-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size ) &#39;</span>[ t0] ),</span>
<span id="cb147-13"><a href="adyr.html#cb147-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size ) &#39;</span>[ t1] ) )</span>
<span id="cb147-14"><a href="adyr.html#cb147-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( i <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">1998</span><span class="sc">:</span><span class="dv">2000</span>, <span class="dv">2002</span><span class="sc">:</span><span class="dv">2004</span>, <span class="dv">2006</span><span class="sc">:</span><span class="dv">2008</span> ) ){</span>
<span id="cb147-15"><a href="adyr.html#cb147-15" aria-hidden="true" tabindex="-1"></a>    temp_plot <span class="ot">&lt;-</span> temp_plot <span class="sc">+</span> <span class="fu">theme</span>( <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>( ) )</span>
<span id="cb147-16"><a href="adyr.html#cb147-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-17"><a href="adyr.html#cb147-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb147-18"><a href="adyr.html#cb147-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(temp_plot)</span>
<span id="cb147-19"><a href="adyr.html#cb147-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb147-20"><a href="adyr.html#cb147-20" aria-hidden="true" tabindex="-1"></a>grow_yrs <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span>, grow_yr_plots )</span>
<span id="cb147-21"><a href="adyr.html#cb147-21" aria-hidden="true" tabindex="-1"></a>grow_years <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>( grow_yrs ) <span class="sc">+</span> <span class="fu">plot_layout</span>( <span class="at">nrow =</span> <span class="dv">4</span> )</span>
<span id="cb147-22"><a href="adyr.html#cb147-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-23"><a href="adyr.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/grow_pred.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb147-24"><a href="adyr.html#cb147-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-25"><a href="adyr.html#cb147-25" aria-hidden="true" tabindex="-1"></a>grow_years</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-70-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="adyr.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>From these plots, it is fairly difficult to see how each plot has a unique model intercept and slope, since each year seems to be fit pretty well. In general, most year-specific models are underestimating the size at time t1 of the largest individuals, but the regression line seems pretty great otherwise.</p>
<p>Before we move onto the growth variance model, let‚Äôs take a moment to consider if this really is the best model. With both the survival and growth models, we assumed that the simplest model with only linear terms best describes the data. With the survival model, I will just reveal that including nonlinear terms causes the model to fail to converge. It‚Äôs hard to visually confirm that our model fits well without linear terms due to the more abstract nature of the logistic regression, but with our linear growth model, we can see in the previous plot that there might be room for improvement. Let‚Äôs compare this growth model to two other models which include nonlinear terms. The first will include a quadratic term, and the second will include a quadratic term and a cubic term. The expressions for these models are:
<span class="math display">\[\mu_{g2,yr} = \beta_{g0,yr} + \beta_{g1,yr} * z + \beta_{g2,yr} * z^2\]</span>
<span class="math display">\[\mu_{g3,yr} = \beta_{g0,yr} + \beta_{g1,yr} * z + \beta_{g2,yr} * z^2 + \beta_{g3,yr} * z^3\]</span></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="adyr.html#cb149-1" aria-hidden="true" tabindex="-1"></a>grow_df<span class="sc">$</span>logarea_t0_2 <span class="ot">&lt;-</span> grow_df<span class="sc">$</span>logarea_t0<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb149-2"><a href="adyr.html#cb149-2" aria-hidden="true" tabindex="-1"></a>grow_df<span class="sc">$</span>logarea_t0_3 <span class="ot">&lt;-</span> grow_df<span class="sc">$</span>logarea_t0<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb149-3"><a href="adyr.html#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="adyr.html#cb149-4" aria-hidden="true" tabindex="-1"></a>gr_mod_yr2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( logarea_t1 <span class="sc">~</span> logarea_t0 <span class="sc">+</span> logarea_t0_2 <span class="sc">+</span> ( logarea_t0 <span class="sc">|</span> Year ), <span class="at">data =</span> grow_df )</span>
<span id="cb149-5"><a href="adyr.html#cb149-5" aria-hidden="true" tabindex="-1"></a>gr_mod_yr3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( logarea_t1 <span class="sc">~</span> logarea_t0 <span class="sc">+</span> logarea_t0_2 <span class="sc">+</span> logarea_t0_3 <span class="sc">+</span> ( logarea_t0 <span class="sc">|</span> Year ), <span class="at">data =</span> grow_df )</span>
<span id="cb149-6"><a href="adyr.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="adyr.html#cb149-7" aria-hidden="true" tabindex="-1"></a>g_mods <span class="ot">&lt;-</span> <span class="fu">c</span>( gr_mod_yr, gr_mod_yr2, gr_mod_yr3 )</span>
<span id="cb149-8"><a href="adyr.html#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="adyr.html#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="fu">AICtab</span>( g_mods, <span class="at">weights =</span> T )</span></code></pre></div>
<pre><code>##        dAIC  df weight
## model2   0.0 7  0.9911
## model3   9.4 8  0.0089
## model1 460.1 6  &lt;0.001</code></pre>
<p>Comparing the AIC values of these models indicates that including the quadratic term greatly improves the fit of the model over the model only including the linear term, and adding the cubic term does not improve the fit of the model with the quadratic term.</p>
<p>Let‚Äôs plot the model with the quadratic term:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="adyr.html#cb151-1" aria-hidden="true" tabindex="-1"></a>ranef_gr2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">coef</span>( gr_mod_yr2 )[<span class="dv">1</span>] )</span>
<span id="cb151-2"><a href="adyr.html#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="adyr.html#cb151-3" aria-hidden="true" tabindex="-1"></a>grow_yr_plots2 <span class="ot">&lt;-</span> <span class="cf">function</span>( i ){</span>
<span id="cb151-4"><a href="adyr.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  temp_f <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) ranef_gr2[<span class="fu">which</span>(<span class="fu">rownames</span>( ranef_gr2 ) <span class="sc">==</span> i ),<span class="dv">1</span>] <span class="sc">+</span> ranef_gr2[<span class="fu">which</span>(<span class="fu">rownames</span>( ranef_gr2 ) <span class="sc">==</span> i ),<span class="dv">2</span>] <span class="sc">*</span> x <span class="sc">+</span> ranef_gr2[<span class="fu">which</span>(<span class="fu">rownames</span>( ranef_gr2 ) <span class="sc">==</span> i ),<span class="dv">3</span>] <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb151-5"><a href="adyr.html#cb151-5" aria-hidden="true" tabindex="-1"></a>  temp_plot <span class="ot">&lt;-</span> grow_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Year <span class="sc">==</span> i ) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( ) <span class="sc">+</span></span>
<span id="cb151-6"><a href="adyr.html#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> logarea_t0, </span>
<span id="cb151-7"><a href="adyr.html#cb151-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> logarea_t1 ) ) <span class="sc">+</span></span>
<span id="cb151-8"><a href="adyr.html#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_function</span>( <span class="at">fun =</span> temp_f,</span>
<span id="cb151-9"><a href="adyr.html#cb151-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb151-10"><a href="adyr.html#cb151-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lwd   =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb151-11"><a href="adyr.html#cb151-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>( i ),</span>
<span id="cb151-12"><a href="adyr.html#cb151-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size ) &#39;</span>[ t0] ),</span>
<span id="cb151-13"><a href="adyr.html#cb151-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="fu">expression</span>( <span class="st">&#39;log( size ) &#39;</span>[ t1] ) )</span>
<span id="cb151-14"><a href="adyr.html#cb151-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( i <span class="sc">%in%</span> <span class="fu">c</span>( <span class="dv">1998</span><span class="sc">:</span><span class="dv">2000</span>, <span class="dv">2002</span><span class="sc">:</span><span class="dv">2004</span>, <span class="dv">2006</span><span class="sc">:</span><span class="dv">2008</span> ) ){</span>
<span id="cb151-15"><a href="adyr.html#cb151-15" aria-hidden="true" tabindex="-1"></a>    temp_plot <span class="ot">&lt;-</span> temp_plot <span class="sc">+</span> <span class="fu">theme</span>( <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>( ) )</span>
<span id="cb151-16"><a href="adyr.html#cb151-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-17"><a href="adyr.html#cb151-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-18"><a href="adyr.html#cb151-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(temp_plot)</span>
<span id="cb151-19"><a href="adyr.html#cb151-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-20"><a href="adyr.html#cb151-20" aria-hidden="true" tabindex="-1"></a>grow_yrs2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span>, grow_yr_plots2 )</span>
<span id="cb151-21"><a href="adyr.html#cb151-21" aria-hidden="true" tabindex="-1"></a>grow_years2 <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>( grow_yrs2 ) <span class="sc">+</span> <span class="fu">plot_layout</span>( <span class="at">nrow =</span> <span class="dv">4</span> )</span>
<span id="cb151-22"><a href="adyr.html#cb151-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-23"><a href="adyr.html#cb151-23" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/grow_pred_2.png&#39;, width = 10, height = 6, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb151-24"><a href="adyr.html#cb151-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-25"><a href="adyr.html#cb151-25" aria-hidden="true" tabindex="-1"></a>grow_years2</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-72-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="adyr.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>And just for fun, I‚Äôll also plot the model with the cubic term and we can compare all three models:
<img src="rupdemo-webpage_files/figure-html/unnamed-chunk-73-1.png" width="1248" style="display: block; margin: auto;" /></p>
<p>Here, I‚Äôve plotted the model with only the linear term on the top row (red line), the model with the added quadratic term on the middle row (green line), and the model with the added cubic term on the bottom row (blue line). I have also only plotted 2003 through 2009 for improved readability. First, notice how the green line fits the largest and smallest individuals much better than the red. Second, notice that there is virtually no change when comparing the fit of the green vs the blue line. Therefore, choosing the model with the quadratic term but without the cubic term makes the most sense here.</p>
<p>Now that we‚Äôve decided on which growth model we will choose, we need to fit the growth variance model.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="adyr.html#cb153-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">fitted</span>( gr_mod_yr2 )</span>
<span id="cb153-2"><a href="adyr.html#cb153-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">resid</span>( gr_mod_yr2 )<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb153-3"><a href="adyr.html#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="adyr.html#cb153-4" aria-hidden="true" tabindex="-1"></a>gr_var <span class="ot">&lt;-</span> <span class="fu">nls</span>( y <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>( b <span class="sc">*</span> x ), <span class="at">start =</span> <span class="fu">list</span>( <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">0</span> ) )</span></code></pre></div>
<p>This is the same model as the one we wrote in Chapter 4 <a href="adwf.html#growvr4">4.4.8.1</a>, as the growth variance model does not change by year.</p>
</div>
<div id="recruitment-model-3" class="section level4 hasAnchor" number="6.0.5.3">
<h4><span class="header-section-number">6.0.5.3</span> Recruitment model<a href="adyr.html#recruitment-model-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we model the number of recruits using the negative binomial distribution with the random effect of year:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="adyr.html#cb154-1" aria-hidden="true" tabindex="-1"></a>rec_mod <span class="ot">&lt;-</span> <span class="fu">glmer.nb</span>( NRquad <span class="sc">~</span> ( <span class="dv">1</span> <span class="sc">|</span> Year ), <span class="at">data =</span> recr )</span></code></pre></div>
<p>Then, we use the <code>predict( )</code> function to predict the number of recruits per year per quad, group the data by year, and sum up the observed and predicted number of recruits per year across all quads:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="adyr.html#cb155-1" aria-hidden="true" tabindex="-1"></a>recr_df        <span class="ot">&lt;-</span> recr <span class="sc">%&gt;%</span> </span>
<span id="cb155-2"><a href="adyr.html#cb155-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>( <span class="at">pred_mod      =</span> <span class="fu">predict</span>( rec_mod, <span class="at">type =</span> <span class="st">&#39;response&#39;</span> ) ) </span>
<span id="cb155-3"><a href="adyr.html#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="adyr.html#cb155-4" aria-hidden="true" tabindex="-1"></a>rec_sums_df <span class="ot">&lt;-</span> recr_df <span class="sc">%&gt;%</span> </span>
<span id="cb155-5"><a href="adyr.html#cb155-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>( Year ) <span class="sc">%&gt;%</span> </span>
<span id="cb155-6"><a href="adyr.html#cb155-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>( <span class="at">NRquad    =</span> <span class="fu">sum</span>( NRquad ),</span>
<span id="cb155-7"><a href="adyr.html#cb155-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">pred_mod  =</span> <span class="fu">sum</span>( pred_mod ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb155-8"><a href="adyr.html#cb155-8" aria-hidden="true" tabindex="-1"></a>   ungroup</span></code></pre></div>
<p>Then, we sum up the number of adults present in each year, and rename the year column so we can link the number of adults at time t0 to the number of recruits at time t1:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="adyr.html#cb156-1" aria-hidden="true" tabindex="-1"></a>indiv_yr <span class="ot">&lt;-</span> surv_df <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="adyr.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>( Year ) <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="adyr.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>( <span class="at">n_adults =</span> n ) <span class="sc">%&gt;%</span> </span>
<span id="cb156-4"><a href="adyr.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> Year <span class="sc">+</span> <span class="dv">1</span> )</span></code></pre></div>
<p>Finally, we join these two dataframes and calculate a per-capita recruitment rate based on our model and on the observed recruits:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="adyr.html#cb157-1" aria-hidden="true" tabindex="-1"></a>repr_pc_yr <span class="ot">&lt;-</span> indiv_yr <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="adyr.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>( rec_sums_df ) <span class="sc">%&gt;%</span></span>
<span id="cb157-3"><a href="adyr.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">repr_percapita =</span> pred_mod <span class="sc">/</span> n_adults ) <span class="sc">%&gt;%</span> </span>
<span id="cb157-4"><a href="adyr.html#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">repr_pc_obs    =</span> NRquad <span class="sc">/</span> n_adults ) <span class="sc">%&gt;%</span> </span>
<span id="cb157-5"><a href="adyr.html#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> Year <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb157-6"><a href="adyr.html#cb157-6" aria-hidden="true" tabindex="-1"></a>  drop_na</span></code></pre></div>
<p>And now we can plot the data against the model predictions:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="adyr.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/recruit_pred.png&#39;, width = 6, height = 4, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb158-2"><a href="adyr.html#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="adyr.html#cb158-3" aria-hidden="true" tabindex="-1"></a>repr_pc_yr <span class="sc">%&gt;%</span> </span>
<span id="cb158-4"><a href="adyr.html#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb158-5"><a href="adyr.html#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> repr_pc_obs,</span>
<span id="cb158-6"><a href="adyr.html#cb158-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> repr_percapita ) ) <span class="sc">+</span></span>
<span id="cb158-7"><a href="adyr.html#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>( <span class="fu">aes</span>( <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb158-8"><a href="adyr.html#cb158-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">slope     =</span> <span class="dv">1</span> ),</span>
<span id="cb158-9"><a href="adyr.html#cb158-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color     =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb158-10"><a href="adyr.html#cb158-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lwd       =</span> <span class="dv">2</span>,</span>
<span id="cb158-11"><a href="adyr.html#cb158-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha     =</span> <span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb158-12"><a href="adyr.html#cb158-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;Observed per capita recruitment&quot;</span>,</span>
<span id="cb158-13"><a href="adyr.html#cb158-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Predicted per capita recruitment&quot;</span> )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-79-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="adyr.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<p>On the x axis, we have the observed per-capita recruitment rates and on the y axis are the corresponding modeled per-capita recruitment rates. Each point shows a single transition year. Most points are very close to the 1:1 line, indicating the model predicts most years well. We see that the two points with the highest observed recruitment are less accurately predicted by the model, but this is not so unrealistic: recall that one plot with over 600 recruits in a single year, which is clearly going to have a strong influence on the mean recruitment rate of that year.</p>
</div>
<div id="exporting-parameter-estimates-1" class="section level4 hasAnchor" number="6.0.5.4">
<h4><span class="header-section-number">6.0.5.4</span> Exporting parameter estimates<a href="adyr.html#exporting-parameter-estimates-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that we‚Äôve modeled all of the vital rates and calculated all of the varying parameters, we need to store the values in dataframes that we can work with in the next step, constructing the IPMs. As with our mean model, we will export one dataframe for each model. We will also rearrange the parameters into two dataframes: one which contains mean model parameter estimates plus all parameters which do not vary across the years, and one which contains only estimates of the parameters which vary across the years.</p>
<p>Let‚Äôs start with the survival model:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="adyr.html#cb160-1" aria-hidden="true" tabindex="-1"></a>su_yr_r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;year_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year ) ), </span>
<span id="cb160-2"><a href="adyr.html#cb160-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year[,<span class="st">&quot;(Intercept)&quot;</span>] )</span>
<span id="cb160-3"><a href="adyr.html#cb160-3" aria-hidden="true" tabindex="-1"></a>su_la_r <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;logarea_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year ) ), </span>
<span id="cb160-4"><a href="adyr.html#cb160-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year[,<span class="st">&quot;logarea&quot;</span>] )</span>
<span id="cb160-5"><a href="adyr.html#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="adyr.html#cb160-6" aria-hidden="true" tabindex="-1"></a>surv_out_yr <span class="ot">&lt;-</span> <span class="fu">Reduce</span>( <span class="cf">function</span>(...) <span class="fu">rbind</span>(...), <span class="fu">list</span>( su_la_r, su_yr_r ) ) <span class="sc">%&gt;%</span></span>
<span id="cb160-7"><a href="adyr.html#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">coefficient =</span> <span class="fu">as.character</span>( coefficient ) )</span>
<span id="cb160-8"><a href="adyr.html#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="adyr.html#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( surv_out_yr, &quot;data/Bou_gra_yr/surv_pars.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>And then the growth model:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="adyr.html#cb161-1" aria-hidden="true" tabindex="-1"></a>var_fe  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">names</span>( <span class="fu">coef</span>( gr_var ) ),</span>
<span id="cb161-2"><a href="adyr.html#cb161-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_var ) )</span>
<span id="cb161-3"><a href="adyr.html#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="adyr.html#cb161-4" aria-hidden="true" tabindex="-1"></a>year_re <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;year_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb161-5"><a href="adyr.html#cb161-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;(Intercept)&quot;</span>] )</span>
<span id="cb161-6"><a href="adyr.html#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="adyr.html#cb161-7" aria-hidden="true" tabindex="-1"></a>la_re   <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;logarea_t0_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb161-8"><a href="adyr.html#cb161-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;logarea_t0&quot;</span>] )</span>
<span id="cb161-9"><a href="adyr.html#cb161-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-10"><a href="adyr.html#cb161-10" aria-hidden="true" tabindex="-1"></a>la2_re  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;logarea_t0_2_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb161-11"><a href="adyr.html#cb161-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;logarea_t0_2&quot;</span>] )</span>
<span id="cb161-12"><a href="adyr.html#cb161-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-13"><a href="adyr.html#cb161-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-14"><a href="adyr.html#cb161-14" aria-hidden="true" tabindex="-1"></a>grow_out_yr <span class="ot">&lt;-</span> <span class="fu">Reduce</span>( <span class="cf">function</span>(...) <span class="fu">rbind</span>(...), <span class="fu">list</span>( var_fe, la_re, la2_re, year_re ) ) <span class="sc">%&gt;%</span></span>
<span id="cb161-15"><a href="adyr.html#cb161-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">coefficient =</span> <span class="fu">as.character</span>( coefficient ) )</span>
<span id="cb161-16"><a href="adyr.html#cb161-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-17"><a href="adyr.html#cb161-17" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( grow_out_yr, &quot;data/Bou_gra_yr/grow_pars.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>And the recruitment model:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="adyr.html#cb162-1" aria-hidden="true" tabindex="-1"></a>rc_pc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;rec_pc_&quot;</span>, repr_pc_yr<span class="sc">$</span>Year ),</span>
<span id="cb162-2"><a href="adyr.html#cb162-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">value =</span> repr_pc_yr<span class="sc">$</span>repr_percapita )</span>
<span id="cb162-3"><a href="adyr.html#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="adyr.html#cb162-4" aria-hidden="true" tabindex="-1"></a>rc_sz <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">c</span>( <span class="st">&quot;rec_siz&quot;</span>, <span class="st">&quot;rec_sd&quot;</span> ),</span>
<span id="cb162-5"><a href="adyr.html#cb162-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">value =</span> <span class="fu">c</span>( <span class="fu">mean</span>( recSize<span class="sc">$</span>logsize ),</span>
<span id="cb162-6"><a href="adyr.html#cb162-6" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">sd</span>( recSize<span class="sc">$</span>logsize ) ) )</span>
<span id="cb162-7"><a href="adyr.html#cb162-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-8"><a href="adyr.html#cb162-8" aria-hidden="true" tabindex="-1"></a>recr_out_yr <span class="ot">&lt;-</span> <span class="fu">Reduce</span>( <span class="cf">function</span>(...) <span class="fu">rbind</span>(...), <span class="fu">list</span>( rc_pc, rc_sz ) ) <span class="sc">%&gt;%</span></span>
<span id="cb162-9"><a href="adyr.html#cb162-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">coefficient =</span> <span class="fu">as.character</span>( coefficient ) )</span>
<span id="cb162-10"><a href="adyr.html#cb162-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-11"><a href="adyr.html#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( recr_out_yr, &quot;data/Bou_gra_yr/recr_pars.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>Next, let‚Äôs put the constant parameters, fixed effects estimates, and mean parameter estimates into a dataframe. These values can be used to construct the mean IPM, or to construct IPMs holding individual vital rate parameters constant for testing. This dataframe also contains the parameters which will not vary across all year-specific IPMs, such as the bounds of integration, the number of bins, the parameters for the growth variance model, and the recruit size parameters.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="adyr.html#cb163-1" aria-hidden="true" tabindex="-1"></a>constants <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">c</span>( <span class="st">&quot;recr_sz&quot;</span>,</span>
<span id="cb163-2"><a href="adyr.html#cb163-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;recr_sd&quot;</span>,</span>
<span id="cb163-3"><a href="adyr.html#cb163-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;a&quot;</span>,</span>
<span id="cb163-4"><a href="adyr.html#cb163-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;b&quot;</span>,</span>
<span id="cb163-5"><a href="adyr.html#cb163-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;L&quot;</span>,</span>
<span id="cb163-6"><a href="adyr.html#cb163-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;U&quot;</span>,</span>
<span id="cb163-7"><a href="adyr.html#cb163-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;mat_siz&quot;</span> ),</span>
<span id="cb163-8"><a href="adyr.html#cb163-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> <span class="fu">c</span>( <span class="fu">mean</span>( recSize<span class="sc">$</span>logsize ),</span>
<span id="cb163-9"><a href="adyr.html#cb163-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">sd</span>( recSize<span class="sc">$</span>logsize ),</span>
<span id="cb163-10"><a href="adyr.html#cb163-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">as.numeric</span>(<span class="fu">coef</span>(gr_var)[<span class="dv">1</span>]),</span>
<span id="cb163-11"><a href="adyr.html#cb163-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">as.numeric</span>(<span class="fu">coef</span>(gr_var)[<span class="dv">2</span>]),</span>
<span id="cb163-12"><a href="adyr.html#cb163-12" aria-hidden="true" tabindex="-1"></a>                                    grow_df<span class="sc">$</span>logarea_t0 <span class="sc">%&gt;%</span> min,</span>
<span id="cb163-13"><a href="adyr.html#cb163-13" aria-hidden="true" tabindex="-1"></a>                                    grow_df<span class="sc">$</span>logarea_t0 <span class="sc">%&gt;%</span> max,</span>
<span id="cb163-14"><a href="adyr.html#cb163-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="dv">200</span> ) )</span>
<span id="cb163-15"><a href="adyr.html#cb163-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-16"><a href="adyr.html#cb163-16" aria-hidden="true" tabindex="-1"></a>surv_fe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">c</span>( <span class="st">&quot;surv_b0&quot;</span>,</span>
<span id="cb163-17"><a href="adyr.html#cb163-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;surv_b1&quot;</span> ),</span>
<span id="cb163-18"><a href="adyr.html#cb163-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">fixef</span>( su_mod_yr ) )</span>
<span id="cb163-19"><a href="adyr.html#cb163-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-20"><a href="adyr.html#cb163-20" aria-hidden="true" tabindex="-1"></a>grow_fe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">c</span>( <span class="st">&quot;grow_b0&quot;</span>,</span>
<span id="cb163-21"><a href="adyr.html#cb163-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;grow_b1&quot;</span>,</span>
<span id="cb163-22"><a href="adyr.html#cb163-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;grow_b2&quot;</span> ),</span>
<span id="cb163-23"><a href="adyr.html#cb163-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">fixef</span>( gr_mod_yr2 ) )</span>
<span id="cb163-24"><a href="adyr.html#cb163-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-25"><a href="adyr.html#cb163-25" aria-hidden="true" tabindex="-1"></a>rec_fe  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="st">&quot;fecu_b0&quot;</span>,</span>
<span id="cb163-26"><a href="adyr.html#cb163-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">mean</span>( repr_pc_yr<span class="sc">$</span>repr_percapita ) )</span>
<span id="cb163-27"><a href="adyr.html#cb163-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-28"><a href="adyr.html#cb163-28" aria-hidden="true" tabindex="-1"></a>pars_cons <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(...) <span class="fu">rbind</span>(...), <span class="fu">list</span>( surv_fe, grow_fe, rec_fe, constants ) ) <span class="sc">%&gt;%</span></span>
<span id="cb163-29"><a href="adyr.html#cb163-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">coefficient =</span> <span class="fu">as.character</span>( coefficient ) )</span>
<span id="cb163-30"><a href="adyr.html#cb163-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-31"><a href="adyr.html#cb163-31" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>( pars_cons ) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span></span>
<span id="cb163-32"><a href="adyr.html#cb163-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-33"><a href="adyr.html#cb163-33" aria-hidden="true" tabindex="-1"></a>pars_cons_wide <span class="ot">&lt;-</span> <span class="fu">as.list</span>( <span class="fu">pivot_wider</span>( pars_cons, <span class="at">names_from =</span> <span class="st">&quot;coefficient&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span> ) )</span>
<span id="cb163-34"><a href="adyr.html#cb163-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-35"><a href="adyr.html#cb163-35" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( pars_cons_wide, &quot;data/Bou_gra_yr/pars_cons.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>Lastly, let‚Äôs put all of the varying parameters into their own dataframe, too. This will also be useful in the testing stage.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="adyr.html#cb164-1" aria-hidden="true" tabindex="-1"></a>su_b0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;surv_b0_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year ) ), </span>
<span id="cb164-2"><a href="adyr.html#cb164-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year[,<span class="st">&quot;(Intercept)&quot;</span>] )</span>
<span id="cb164-3"><a href="adyr.html#cb164-3" aria-hidden="true" tabindex="-1"></a>su_b1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;surv_b1_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year ) ), </span>
<span id="cb164-4"><a href="adyr.html#cb164-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( su_mod_yr )<span class="sc">$</span>Year[,<span class="st">&quot;logarea&quot;</span>] )</span>
<span id="cb164-5"><a href="adyr.html#cb164-5" aria-hidden="true" tabindex="-1"></a>grow_b0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;grow_b0_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb164-6"><a href="adyr.html#cb164-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;(Intercept)&quot;</span>] )</span>
<span id="cb164-7"><a href="adyr.html#cb164-7" aria-hidden="true" tabindex="-1"></a>grow_b1   <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;grow_b1_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb164-8"><a href="adyr.html#cb164-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;logarea_t0&quot;</span>] )</span>
<span id="cb164-9"><a href="adyr.html#cb164-9" aria-hidden="true" tabindex="-1"></a>grow_b2   <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;grow_b2_&quot;</span>, <span class="fu">rownames</span>( <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year ) ), </span>
<span id="cb164-10"><a href="adyr.html#cb164-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value       =</span> <span class="fu">coef</span>( gr_mod_yr2 )<span class="sc">$</span>Year[,<span class="st">&quot;logarea_t0_2&quot;</span>] )</span>
<span id="cb164-11"><a href="adyr.html#cb164-11" aria-hidden="true" tabindex="-1"></a>fecu_b0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">paste0</span>( <span class="st">&quot;fecu_b0_&quot;</span>, repr_pc_yr<span class="sc">$</span>Year ),</span>
<span id="cb164-12"><a href="adyr.html#cb164-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">value =</span> repr_pc_yr<span class="sc">$</span>repr_percapita )</span>
<span id="cb164-13"><a href="adyr.html#cb164-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-14"><a href="adyr.html#cb164-14" aria-hidden="true" tabindex="-1"></a>pars_var <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(...) <span class="fu">rbind</span>(...), <span class="fu">list</span>( su_b0, su_b1, grow_b0, grow_b1, grow_b2, fecu_b0 ) )</span>
<span id="cb164-15"><a href="adyr.html#cb164-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-16"><a href="adyr.html#cb164-16" aria-hidden="true" tabindex="-1"></a>pars_var_wide <span class="ot">&lt;-</span> <span class="fu">as.list</span>( <span class="fu">pivot_wider</span>( pars_var, <span class="at">names_from =</span> <span class="st">&quot;coefficient&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span> ) )</span>
<span id="cb164-17"><a href="adyr.html#cb164-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-18"><a href="adyr.html#cb164-18" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( pars_var_wide, &quot;data/Bou_gra_yr/pars_var.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>Now that all of our parameter values are organized, we are ready to build the year-specific IPM!</p>
</div>
</div>
<div id="building-the-year-specific-ipms-from-scratch" class="section level3 hasAnchor" number="6.0.6">
<h3><span class="header-section-number">6.0.6</span> 9. Building the year-specific IPMs from scratch<a href="adyr.html#building-the-year-specific-ipms-from-scratch" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Chapter 4, we built the mean IPM from scratch, which we will now expand upon to create the year-specific IPMs. We can borrow most of the vital rate functions we wrote in Chapter 4, even though our vital rate expressions now contain the <span class="math inline">\(_{yr}\)</span> subscript on most of the terms. Once we build the IPM, we can just input the year-specific parameter values into the kernel function one year at a time.</p>
<p>We need to first update the growth vital rate function to accommodate the changes we made when we selected a better-fitting model. Recall the mathematical notation of the new model:
<span class="math display">\[\mu_{g2,yr} = \beta_{g0,yr} + \beta_{g1,yr} * z + \beta_{g2,yr} * z^2\]</span>
And how we wrote the model expression in R:</p>
<pre><code>lmer( logarea_t1 ~ logarea_t0 + logarea_t0_2 + ( logarea_t0 | Year ), data = grow_df )</code></pre>
<p>Let‚Äôs write the function describing the model of standard deviation of the growth model, and then the revised function describing growth from size at time t0 to size at time t1. The revised growth function just has the added quadratic term:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="adyr.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard deviation of growth model</span></span>
<span id="cb166-2"><a href="adyr.html#cb166-2" aria-hidden="true" tabindex="-1"></a>grow_sd <span class="ot">&lt;-</span> <span class="cf">function</span>( x, pars ) {</span>
<span id="cb166-3"><a href="adyr.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  pars<span class="sc">$</span>a <span class="sc">*</span> ( <span class="fu">exp</span>( pars<span class="sc">$</span>b <span class="sc">*</span> x ) ) <span class="sc">%&gt;%</span> sqrt </span>
<span id="cb166-4"><a href="adyr.html#cb166-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-5"><a href="adyr.html#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="adyr.html#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Growth from size x to size y</span></span>
<span id="cb166-7"><a href="adyr.html#cb166-7" aria-hidden="true" tabindex="-1"></a>gxy <span class="ot">&lt;-</span> <span class="cf">function</span>( x, y, pars ) {</span>
<span id="cb166-8"><a href="adyr.html#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">dnorm</span>( y,  <span class="at">mean =</span> pars<span class="sc">$</span>grow_b0 <span class="sc">+</span> pars<span class="sc">$</span>grow_b1<span class="sc">*</span>x <span class="sc">+</span> pars<span class="sc">$</span>grow_b2<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb166-9"><a href="adyr.html#cb166-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sd   =</span> <span class="fu">grow_sd</span>( x, pars ) ) )</span>
<span id="cb166-10"><a href="adyr.html#cb166-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can load the survival functions, and the function describing the P kernel:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="adyr.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse logit</span></span>
<span id="cb167-2"><a href="adyr.html#cb167-2" aria-hidden="true" tabindex="-1"></a>inv_logit <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) { <span class="fu">exp</span>( x ) <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>( x ) ) }</span>
<span id="cb167-3"><a href="adyr.html#cb167-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-4"><a href="adyr.html#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Survival of x-sized individual to time t1</span></span>
<span id="cb167-5"><a href="adyr.html#cb167-5" aria-hidden="true" tabindex="-1"></a>sx <span class="ot">&lt;-</span> <span class="cf">function</span>( x, pars ) {</span>
<span id="cb167-6"><a href="adyr.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">inv_logit</span>( pars<span class="sc">$</span>surv_b0 <span class="sc">+</span> pars<span class="sc">$</span>surv_b1 <span class="sc">*</span> x ) )</span>
<span id="cb167-7"><a href="adyr.html#cb167-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb167-8"><a href="adyr.html#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="adyr.html#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition of x-sized individual to y-sized individual at time t1</span></span>
<span id="cb167-10"><a href="adyr.html#cb167-10" aria-hidden="true" tabindex="-1"></a>pxy <span class="ot">&lt;-</span> <span class="cf">function</span>( x, y, pars ) {</span>
<span id="cb167-11"><a href="adyr.html#cb167-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">sx</span>( x, pars ) <span class="sc">*</span> <span class="fu">gxy</span>( x, y, pars ) )</span>
<span id="cb167-12"><a href="adyr.html#cb167-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And finally the recruitment function:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="adyr.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-capita production of y-sized recruits</span></span>
<span id="cb168-2"><a href="adyr.html#cb168-2" aria-hidden="true" tabindex="-1"></a>fy <span class="ot">&lt;-</span> <span class="cf">function</span>( y, pars, h ){</span>
<span id="cb168-3"><a href="adyr.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  n_recr  <span class="ot">&lt;-</span> pars<span class="sc">$</span>fecu_b0</span>
<span id="cb168-4"><a href="adyr.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  recr_y  <span class="ot">&lt;-</span> <span class="fu">dnorm</span>( y, pars<span class="sc">$</span>recr_sz, pars<span class="sc">$</span>recr_sd ) <span class="sc">*</span> h</span>
<span id="cb168-5"><a href="adyr.html#cb168-5" aria-hidden="true" tabindex="-1"></a>  recr_y  <span class="ot">&lt;-</span> recr_y <span class="sc">/</span> <span class="fu">sum</span>( recr_y )</span>
<span id="cb168-6"><a href="adyr.html#cb168-6" aria-hidden="true" tabindex="-1"></a>  f       <span class="ot">&lt;-</span> n_recr <span class="sc">*</span> recr_y</span>
<span id="cb168-7"><a href="adyr.html#cb168-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( f )</span>
<span id="cb168-8"><a href="adyr.html#cb168-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb168-9"><a href="adyr.html#cb168-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next we can assemble the kernel function. I have removed the comments to save space; refer to Chapter 4 <a href="adwf.html#buildipm4">4.4.9</a> for further explanation.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="adyr.html#cb169-1" aria-hidden="true" tabindex="-1"></a>kernel <span class="ot">&lt;-</span> <span class="cf">function</span>( pars ) {</span>
<span id="cb169-2"><a href="adyr.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-3"><a href="adyr.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  n   <span class="ot">&lt;-</span> pars<span class="sc">$</span>mat_siz</span>
<span id="cb169-4"><a href="adyr.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  L   <span class="ot">&lt;-</span> pars<span class="sc">$</span>L</span>
<span id="cb169-5"><a href="adyr.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  U   <span class="ot">&lt;-</span> pars<span class="sc">$</span>U</span>
<span id="cb169-6"><a href="adyr.html#cb169-6" aria-hidden="true" tabindex="-1"></a>  h   <span class="ot">&lt;-</span> ( U <span class="sc">-</span> L ) <span class="sc">/</span> n</span>
<span id="cb169-7"><a href="adyr.html#cb169-7" aria-hidden="true" tabindex="-1"></a>  b   <span class="ot">&lt;-</span> L <span class="sc">+</span> <span class="fu">c</span>( <span class="dv">0</span><span class="sc">:</span>n ) <span class="sc">*</span> h</span>
<span id="cb169-8"><a href="adyr.html#cb169-8" aria-hidden="true" tabindex="-1"></a>  y   <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> ( b[<span class="dv">1</span><span class="sc">:</span>n] <span class="sc">+</span> b[<span class="dv">2</span><span class="sc">:</span>( n <span class="sc">+</span> <span class="dv">1</span> )] )</span>
<span id="cb169-9"><a href="adyr.html#cb169-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-10"><a href="adyr.html#cb169-10" aria-hidden="true" tabindex="-1"></a>  Fmat        <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="dv">0</span>, n, n )</span>
<span id="cb169-11"><a href="adyr.html#cb169-11" aria-hidden="true" tabindex="-1"></a>  Fmat[]      <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">fy</span>( y, pars, h ), n, n )</span>
<span id="cb169-12"><a href="adyr.html#cb169-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-13"><a href="adyr.html#cb169-13" aria-hidden="true" tabindex="-1"></a>  Smat   <span class="ot">&lt;-</span> <span class="fu">c</span>( )</span>
<span id="cb169-14"><a href="adyr.html#cb169-14" aria-hidden="true" tabindex="-1"></a>  Smat   <span class="ot">&lt;-</span> <span class="fu">sx</span>( y, pars )</span>
<span id="cb169-15"><a href="adyr.html#cb169-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-16"><a href="adyr.html#cb169-16" aria-hidden="true" tabindex="-1"></a>  Gmat   <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="dv">0</span>, n, n )</span>
<span id="cb169-17"><a href="adyr.html#cb169-17" aria-hidden="true" tabindex="-1"></a>  Gmat[] <span class="ot">&lt;-</span> <span class="fu">t</span>( <span class="fu">outer</span>( y, y, gxy, pars ) ) <span class="sc">*</span> h</span>
<span id="cb169-18"><a href="adyr.html#cb169-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-19"><a href="adyr.html#cb169-19" aria-hidden="true" tabindex="-1"></a>  Tmat   <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="dv">0</span>, n, n )</span>
<span id="cb169-20"><a href="adyr.html#cb169-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-21"><a href="adyr.html#cb169-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>( n <span class="sc">/</span> <span class="dv">2</span> ) ) {</span>
<span id="cb169-22"><a href="adyr.html#cb169-22" aria-hidden="true" tabindex="-1"></a>    Gmat[<span class="dv">1</span>,i] <span class="ot">&lt;-</span> Gmat[<span class="dv">1</span>,i] <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>( Gmat[,i] )</span>
<span id="cb169-23"><a href="adyr.html#cb169-23" aria-hidden="true" tabindex="-1"></a>    Tmat[,i]  <span class="ot">&lt;-</span> Gmat[,i] <span class="sc">*</span> Smat[i]</span>
<span id="cb169-24"><a href="adyr.html#cb169-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-25"><a href="adyr.html#cb169-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-26"><a href="adyr.html#cb169-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> ( n <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span> )<span class="sc">:</span>n ) {</span>
<span id="cb169-27"><a href="adyr.html#cb169-27" aria-hidden="true" tabindex="-1"></a>    Gmat[n,i] <span class="ot">&lt;-</span> Gmat[n,i] <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>( Gmat[,i] )</span>
<span id="cb169-28"><a href="adyr.html#cb169-28" aria-hidden="true" tabindex="-1"></a>    Tmat[,i]  <span class="ot">&lt;-</span> Gmat[,i] <span class="sc">*</span> Smat[i]</span>
<span id="cb169-29"><a href="adyr.html#cb169-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-30"><a href="adyr.html#cb169-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-31"><a href="adyr.html#cb169-31" aria-hidden="true" tabindex="-1"></a>  k_yx <span class="ot">&lt;-</span> Fmat <span class="sc">+</span> Tmat</span>
<span id="cb169-32"><a href="adyr.html#cb169-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-33"><a href="adyr.html#cb169-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">k_yx    =</span> k_yx,</span>
<span id="cb169-34"><a href="adyr.html#cb169-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">Fmat    =</span> Fmat,</span>
<span id="cb169-35"><a href="adyr.html#cb169-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">Tmat    =</span> Tmat,</span>
<span id="cb169-36"><a href="adyr.html#cb169-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">Gmat    =</span> Gmat,</span>
<span id="cb169-37"><a href="adyr.html#cb169-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">meshpts =</span> y ) )</span>
<span id="cb169-38"><a href="adyr.html#cb169-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-39"><a href="adyr.html#cb169-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Using the constant parameters, mean values of calculated parameters, and estimates of the fixed effects in the GLMMs, we can then calculate the mean population growth rate, <span class="math inline">\(\lambda_{mean}\)</span>:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="adyr.html#cb170-1" aria-hidden="true" tabindex="-1"></a>pars_mean <span class="ot">&lt;-</span> pars_cons_wide</span>
<span id="cb170-2"><a href="adyr.html#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="adyr.html#cb170-3" aria-hidden="true" tabindex="-1"></a>lambda_ipm <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb170-4"><a href="adyr.html#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">Re</span>( <span class="fu">eigen</span>( <span class="fu">kernel</span>( i )<span class="sc">$</span>k_yx )<span class="sc">$</span>value[<span class="dv">1</span>] ) )</span>
<span id="cb170-5"><a href="adyr.html#cb170-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-6"><a href="adyr.html#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="adyr.html#cb170-7" aria-hidden="true" tabindex="-1"></a>lam_mean <span class="ot">&lt;-</span> <span class="fu">lambda_ipm</span>( pars_mean )</span>
<span id="cb170-8"><a href="adyr.html#cb170-8" aria-hidden="true" tabindex="-1"></a>lam_mean</span></code></pre></div>
<pre><code>## [1] 1.221076</code></pre>
<p>Now, we can input the year-specific parameter values and calculate the population growth rates for each year, <span class="math inline">\(\lambda_{yr}\)</span>:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="adyr.html#cb172-1" aria-hidden="true" tabindex="-1"></a>bogr_yr <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span> )</span>
<span id="cb172-2"><a href="adyr.html#cb172-2" aria-hidden="true" tabindex="-1"></a>pars_yr <span class="ot">&lt;-</span> <span class="fu">vector</span>( <span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="fu">length</span>( bogr_yr ) )</span>
<span id="cb172-3"><a href="adyr.html#cb172-3" aria-hidden="true" tabindex="-1"></a>extr_value_list <span class="ot">&lt;-</span> <span class="cf">function</span>( x, field ) {</span>
<span id="cb172-4"><a href="adyr.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">as.numeric</span>( x[<span class="fu">paste0</span>( field )] <span class="sc">%&gt;%</span> <span class="fu">unlist</span>( ) ) )</span>
<span id="cb172-5"><a href="adyr.html#cb172-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb172-6"><a href="adyr.html#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="adyr.html#cb172-7" aria-hidden="true" tabindex="-1"></a>prep_pars <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb172-8"><a href="adyr.html#cb172-8" aria-hidden="true" tabindex="-1"></a>  yr_now    <span class="ot">&lt;-</span> bogr_yr[i]</span>
<span id="cb172-9"><a href="adyr.html#cb172-9" aria-hidden="true" tabindex="-1"></a>  pars_year <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">surv_b0 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;surv_b0&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-10"><a href="adyr.html#cb172-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">surv_b1 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;surv_b1&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-11"><a href="adyr.html#cb172-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grow_b0 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;grow_b0&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-12"><a href="adyr.html#cb172-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grow_b1 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;grow_b1&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-13"><a href="adyr.html#cb172-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grow_b2 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;grow_b2&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-14"><a href="adyr.html#cb172-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">a       =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;a&quot;</span> ),</span>
<span id="cb172-15"><a href="adyr.html#cb172-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b       =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;b&quot;</span> ),</span>
<span id="cb172-16"><a href="adyr.html#cb172-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fecu_b0 =</span> <span class="fu">extr_value_list</span>( pars_var_wide, <span class="fu">paste</span>( <span class="st">&quot;fecu_b0&quot;</span>, yr_now, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span> ) ),</span>
<span id="cb172-17"><a href="adyr.html#cb172-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">recr_sz =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;recr_sz&quot;</span> ),</span>
<span id="cb172-18"><a href="adyr.html#cb172-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">recr_sd =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;recr_sd&quot;</span> ),</span>
<span id="cb172-19"><a href="adyr.html#cb172-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">L       =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;L&quot;</span> ),</span>
<span id="cb172-20"><a href="adyr.html#cb172-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">U       =</span> <span class="fu">extr_value_list</span>( pars_cons_wide, <span class="st">&quot;U&quot;</span> ),</span>
<span id="cb172-21"><a href="adyr.html#cb172-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mat_siz =</span> <span class="dv">200</span> )</span>
<span id="cb172-22"><a href="adyr.html#cb172-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( pars_year )</span>
<span id="cb172-23"><a href="adyr.html#cb172-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb172-24"><a href="adyr.html#cb172-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb172-25"><a href="adyr.html#cb172-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-26"><a href="adyr.html#cb172-26" aria-hidden="true" tabindex="-1"></a>pars_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>( bogr_yr ), prep_pars )</span>
<span id="cb172-27"><a href="adyr.html#cb172-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-28"><a href="adyr.html#cb172-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-29"><a href="adyr.html#cb172-29" aria-hidden="true" tabindex="-1"></a>calc_lambda <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb172-30"><a href="adyr.html#cb172-30" aria-hidden="true" tabindex="-1"></a>  lam <span class="ot">&lt;-</span> <span class="fu">Re</span>( <span class="fu">eigen</span>( <span class="fu">kernel</span>( pars_yr[[i]] )<span class="sc">$</span>k_yx )<span class="sc">$</span>value[<span class="dv">1</span>] )</span>
<span id="cb172-31"><a href="adyr.html#cb172-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( lam )</span>
<span id="cb172-32"><a href="adyr.html#cb172-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb172-33"><a href="adyr.html#cb172-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-34"><a href="adyr.html#cb172-34" aria-hidden="true" tabindex="-1"></a>lambdas_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>( bogr_yr ), calc_lambda )</span>
<span id="cb172-35"><a href="adyr.html#cb172-35" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>( lambdas_yr ) <span class="ot">&lt;-</span> bogr_yr</span></code></pre></div>
<div id="comparing-the-year-specific-lambdas" class="section level4 hasAnchor" number="6.0.6.1">
<h4><span class="header-section-number">6.0.6.1</span> Comparing the year-specific lambdas<a href="adyr.html#comparing-the-year-specific-lambdas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will examine these values in a moment. We should also calculate the mean kernel from all of the year-specific kernels, and calculate some other mean lambda values to compare to the lambda from the mean model.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="adyr.html#cb173-1" aria-hidden="true" tabindex="-1"></a>year_kern <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb173-2"><a href="adyr.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">kernel</span>( pars_yr[[i]] )<span class="sc">$</span>k_yx )</span>
<span id="cb173-3"><a href="adyr.html#cb173-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-4"><a href="adyr.html#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="adyr.html#cb173-5" aria-hidden="true" tabindex="-1"></a>kern_yr <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>( bogr_yr ), year_kern )</span>
<span id="cb173-6"><a href="adyr.html#cb173-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-7"><a href="adyr.html#cb173-7" aria-hidden="true" tabindex="-1"></a>all_mat <span class="ot">&lt;-</span> <span class="fu">array</span>( <span class="at">dim =</span> <span class="fu">c</span>( <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">13</span> ) )</span>
<span id="cb173-8"><a href="adyr.html#cb173-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-9"><a href="adyr.html#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>( bogr_yr ) ) {</span>
<span id="cb173-10"><a href="adyr.html#cb173-10" aria-hidden="true" tabindex="-1"></a>  all_mat[,,i] <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>( kern_yr[[i]] )</span>
<span id="cb173-11"><a href="adyr.html#cb173-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-12"><a href="adyr.html#cb173-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-13"><a href="adyr.html#cb173-13" aria-hidden="true" tabindex="-1"></a>mean_kern <span class="ot">&lt;-</span> <span class="fu">apply</span>( all_mat, <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ), mean )</span>
<span id="cb173-14"><a href="adyr.html#cb173-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-15"><a href="adyr.html#cb173-15" aria-hidden="true" tabindex="-1"></a>lam_mean_kern <span class="ot">&lt;-</span> <span class="fu">Re</span>( <span class="fu">eigen</span>( mean_kern )<span class="sc">$</span>value[<span class="dv">1</span>] )</span>
<span id="cb173-16"><a href="adyr.html#cb173-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-17"><a href="adyr.html#cb173-17" aria-hidden="true" tabindex="-1"></a>lam_mean_kern</span></code></pre></div>
<pre><code>## [1] 1.219977</code></pre>
<p>Now, let‚Äôs check the observed population growth rate (changes in number of individuals) against the projected population growth rate. The population growth rate should be more precise than asymptotic lambda in checking our models. Asymptotic lambda is the population growth rate at the ‚Äústable stage distribution‚Äù - the stage distribution that the population reaches after a long period of time.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="adyr.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Population counts at time t0</span></span>
<span id="cb175-2"><a href="adyr.html#cb175-2" aria-hidden="true" tabindex="-1"></a>pop_counts_t0 <span class="ot">&lt;-</span> Bou_gra <span class="sc">%&gt;%</span></span>
<span id="cb175-3"><a href="adyr.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( Year, Quad ) <span class="sc">%&gt;%</span></span>
<span id="cb175-4"><a href="adyr.html#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">n_t0 =</span> <span class="fu">n</span>( ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-5"><a href="adyr.html#cb175-5" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb175-6"><a href="adyr.html#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> Year <span class="sc">+</span> <span class="dv">1</span> )</span>
<span id="cb175-7"><a href="adyr.html#cb175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-8"><a href="adyr.html#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Population counts at time t1</span></span>
<span id="cb175-9"><a href="adyr.html#cb175-9" aria-hidden="true" tabindex="-1"></a>pop_counts_t1 <span class="ot">&lt;-</span> Bou_gra <span class="sc">%&gt;%</span></span>
<span id="cb175-10"><a href="adyr.html#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( Year, Quad ) <span class="sc">%&gt;%</span></span>
<span id="cb175-11"><a href="adyr.html#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">n_t1 =</span> <span class="fu">n</span>( ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-12"><a href="adyr.html#cb175-12" aria-hidden="true" tabindex="-1"></a>  ungroup </span>
<span id="cb175-13"><a href="adyr.html#cb175-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-14"><a href="adyr.html#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate observed population growth rates, </span></span>
<span id="cb175-15"><a href="adyr.html#cb175-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   accounting for discontinued sampling!</span></span>
<span id="cb175-16"><a href="adyr.html#cb175-16" aria-hidden="true" tabindex="-1"></a>pop_counts <span class="ot">&lt;-</span> <span class="fu">left_join</span>( pop_counts_t0, </span>
<span id="cb175-17"><a href="adyr.html#cb175-17" aria-hidden="true" tabindex="-1"></a>                         pop_counts_t1 ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-18"><a href="adyr.html#cb175-18" aria-hidden="true" tabindex="-1"></a>                <span class="co"># by dropping NAs, we remove gaps in sampling!</span></span>
<span id="cb175-19"><a href="adyr.html#cb175-19" aria-hidden="true" tabindex="-1"></a>                drop_na <span class="sc">%&gt;%</span> </span>
<span id="cb175-20"><a href="adyr.html#cb175-20" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>( Year ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-21"><a href="adyr.html#cb175-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>( <span class="at">n_t0 =</span> <span class="fu">sum</span>( n_t0 ),</span>
<span id="cb175-22"><a href="adyr.html#cb175-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n_t1 =</span> <span class="fu">sum</span>( n_t1 ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-23"><a href="adyr.html#cb175-23" aria-hidden="true" tabindex="-1"></a>                ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb175-24"><a href="adyr.html#cb175-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>( <span class="at">obs_pgr =</span> n_t1 <span class="sc">/</span> n_t0 ) <span class="sc">%&gt;%</span> </span>
<span id="cb175-25"><a href="adyr.html#cb175-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>( <span class="at">lambda =</span> lambdas_yr <span class="sc">%&gt;%</span> unlist )</span>
<span id="cb175-26"><a href="adyr.html#cb175-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-27"><a href="adyr.html#cb175-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-28"><a href="adyr.html#cb175-28" aria-hidden="true" tabindex="-1"></a>lam_mean_yr <span class="ot">&lt;-</span> <span class="fu">mean</span>( pop_counts<span class="sc">$</span>lambda, <span class="at">na.rm =</span> T )</span>
<span id="cb175-29"><a href="adyr.html#cb175-29" aria-hidden="true" tabindex="-1"></a>lam_mean_count <span class="ot">&lt;-</span> <span class="fu">mean</span>( pop_counts<span class="sc">$</span>obs_pgr, <span class="at">na.rm =</span> T )</span>
<span id="cb175-30"><a href="adyr.html#cb175-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-31"><a href="adyr.html#cb175-31" aria-hidden="true" tabindex="-1"></a>lam_mean_geom <span class="ot">&lt;-</span> <span class="fu">exp</span>( <span class="fu">mean</span>( <span class="fu">log</span>( pop_counts<span class="sc">$</span>obs_pgr ), <span class="at">na.rm =</span> T ) )</span>
<span id="cb175-32"><a href="adyr.html#cb175-32" aria-hidden="true" tabindex="-1"></a>lam_mean_geom</span></code></pre></div>
<pre><code>## [1] 1.164344</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="adyr.html#cb177-1" aria-hidden="true" tabindex="-1"></a>lam_mean_overall <span class="ot">&lt;-</span> <span class="fu">sum</span>( pop_counts<span class="sc">$</span>n_t1 ) <span class="sc">/</span> <span class="fu">sum</span>( pop_counts<span class="sc">$</span>n_t0 )</span>
<span id="cb177-2"><a href="adyr.html#cb177-2" aria-hidden="true" tabindex="-1"></a>lam_mean_overall</span></code></pre></div>
<pre><code>## [1] 1.05844</code></pre>
<p>We can also check our model by projecting a population vector for each year using the year-specific models, and compare the projected population to the observed population:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="adyr.html#cb179-1" aria-hidden="true" tabindex="-1"></a>count_indivs_by_size <span class="ot">&lt;-</span> <span class="cf">function</span>( size_vector, </span>
<span id="cb179-2"><a href="adyr.html#cb179-2" aria-hidden="true" tabindex="-1"></a>                                  lower_size, </span>
<span id="cb179-3"><a href="adyr.html#cb179-3" aria-hidden="true" tabindex="-1"></a>                                  upper_size, </span>
<span id="cb179-4"><a href="adyr.html#cb179-4" aria-hidden="true" tabindex="-1"></a>                                  matrix_size ){</span>
<span id="cb179-5"><a href="adyr.html#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="adyr.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  size_vector <span class="sc">%&gt;%</span> </span>
<span id="cb179-7"><a href="adyr.html#cb179-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cut</span>( <span class="at">breaks =</span> <span class="fu">seq</span>( lower_size <span class="sc">-</span> <span class="fl">0.00001</span>, </span>
<span id="cb179-8"><a href="adyr.html#cb179-8" aria-hidden="true" tabindex="-1"></a>                       upper_size <span class="sc">+</span> <span class="fl">0.00001</span>, </span>
<span id="cb179-9"><a href="adyr.html#cb179-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">length.out =</span> matrix_size <span class="sc">+</span> <span class="dv">1</span> ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb179-10"><a href="adyr.html#cb179-10" aria-hidden="true" tabindex="-1"></a>    table <span class="sc">%&gt;%</span> </span>
<span id="cb179-11"><a href="adyr.html#cb179-11" aria-hidden="true" tabindex="-1"></a>    as.vector </span>
<span id="cb179-12"><a href="adyr.html#cb179-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-13"><a href="adyr.html#cb179-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-14"><a href="adyr.html#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="adyr.html#cb179-15" aria-hidden="true" tabindex="-1"></a>yr_pop_vec <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb179-16"><a href="adyr.html#cb179-16" aria-hidden="true" tabindex="-1"></a>  vec_temp <span class="ot">&lt;-</span> surv_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Year <span class="sc">==</span> i ) <span class="sc">%&gt;%</span> <span class="fu">select</span>( logsize ) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>( )</span>
<span id="cb179-17"><a href="adyr.html#cb179-17" aria-hidden="true" tabindex="-1"></a>  min_sz   <span class="ot">&lt;-</span> pars_mean<span class="sc">$</span>L</span>
<span id="cb179-18"><a href="adyr.html#cb179-18" aria-hidden="true" tabindex="-1"></a>  max_sz   <span class="ot">&lt;-</span> pars_mean<span class="sc">$</span>U</span>
<span id="cb179-19"><a href="adyr.html#cb179-19" aria-hidden="true" tabindex="-1"></a>  pop_vec <span class="ot">&lt;-</span> <span class="fu">count_indivs_by_size</span>( vec_temp, min_sz, max_sz, <span class="dv">200</span> )</span>
<span id="cb179-20"><a href="adyr.html#cb179-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb179-21"><a href="adyr.html#cb179-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( pop_vec )</span>
<span id="cb179-22"><a href="adyr.html#cb179-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-23"><a href="adyr.html#cb179-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-24"><a href="adyr.html#cb179-24" aria-hidden="true" tabindex="-1"></a>year_pop <span class="ot">&lt;-</span> <span class="fu">lapply</span>( <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span>, yr_pop_vec )</span>
<span id="cb179-25"><a href="adyr.html#cb179-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-26"><a href="adyr.html#cb179-26" aria-hidden="true" tabindex="-1"></a>proj_pop <span class="ot">&lt;-</span> <span class="cf">function</span>( i ) {</span>
<span id="cb179-27"><a href="adyr.html#cb179-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>( all_mat[,,i] <span class="sc">%*%</span> year_pop[[i]] )</span>
<span id="cb179-28"><a href="adyr.html#cb179-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-29"><a href="adyr.html#cb179-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-30"><a href="adyr.html#cb179-30" aria-hidden="true" tabindex="-1"></a>projected_pop_ns  <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, proj_pop )</span>
<span id="cb179-31"><a href="adyr.html#cb179-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-32"><a href="adyr.html#cb179-32" aria-hidden="true" tabindex="-1"></a>pop_counts_update <span class="ot">&lt;-</span> pop_counts <span class="sc">%&gt;%</span> </span>
<span id="cb179-33"><a href="adyr.html#cb179-33" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>( <span class="at">proj_n_t1 =</span> projected_pop_ns ) <span class="sc">%&gt;%</span> </span>
<span id="cb179-34"><a href="adyr.html#cb179-34" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>( <span class="at">proj_pgr  =</span> proj_n_t1<span class="sc">/</span>n_t0 ) </span>
<span id="cb179-35"><a href="adyr.html#cb179-35" aria-hidden="true" tabindex="-1"></a><span class="co"># png( &#39;results/Bou_gra_yr/obs_proj_lambdas.png&#39;, width = 6, height = 4, units = &quot;in&quot;, res = 150 )</span></span>
<span id="cb179-36"><a href="adyr.html#cb179-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-37"><a href="adyr.html#cb179-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( pop_counts_update ) <span class="sc">+</span></span>
<span id="cb179-38"><a href="adyr.html#cb179-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> lambda,</span>
<span id="cb179-39"><a href="adyr.html#cb179-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> obs_pgr ),</span>
<span id="cb179-40"><a href="adyr.html#cb179-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&#39;brown&#39;</span> ) <span class="sc">+</span></span>
<span id="cb179-41"><a href="adyr.html#cb179-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> proj_pgr,</span>
<span id="cb179-42"><a href="adyr.html#cb179-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> obs_pgr ),</span>
<span id="cb179-43"><a href="adyr.html#cb179-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&#39;red&#39;</span> ) <span class="sc">+</span></span>
<span id="cb179-44"><a href="adyr.html#cb179-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>( <span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb179-45"><a href="adyr.html#cb179-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">slope     =</span> <span class="dv">1</span>) ) <span class="sc">+</span></span>
<span id="cb179-46"><a href="adyr.html#cb179-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;Modeled lambda&quot;</span>,</span>
<span id="cb179-47"><a href="adyr.html#cb179-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">&quot;Observed population growth rate&quot;</span> )</span></code></pre></div>
<p><img src="rupdemo-webpage_files/figure-html/unnamed-chunk-93-1.png" width="768" /></p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="adyr.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dev.off( )</span></span></code></pre></div>
<center>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Year
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
<i>n<sub>t0</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
<i>n<sub>t1</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Observed<br>population growth
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Yearly asymptotic<br>lambda
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Projected<br><i>n<sub>t1</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Projected<br>population growth
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1998
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
42
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
58
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.381
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.277
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
69
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.646
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1999
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
58
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
159
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.741
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.291
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
151
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.608
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2000
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
49
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
84
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.714
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.947
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
120
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.446
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2001
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
84
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
74
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.881
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.076
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
97
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.15
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2002
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
174
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
934
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
5.368
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
3.678
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
653
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
3.75
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2003
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
934
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
286
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.306
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.907
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
363
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.388
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2004
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
286
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
283
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.99
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.896
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
214
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.748
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2005
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
283
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
173
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.611
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.974
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
216
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.763
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2006
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
173
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
233
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.347
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.257
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
213
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.23
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2007
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
233
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
314
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.348
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.165
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
276
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.186
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2008
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
314
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
342
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.089
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.027
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
325
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.035
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2009
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
342
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
245
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.716
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.972
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
267
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.78
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
2010
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
245
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
220
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.898
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.967
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
202
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.826
</td>
</tr>
</tbody>
</table>
</center>
<p>Once we are satisfied with our IPM, we can begin constructing it with ipmr.</p>
</div>
</div>
<div id="building-the-year-specific-ipms-with-ipmr" class="section level3 hasAnchor" number="6.0.7">
<h3><span class="header-section-number">6.0.7</span> 10. Building the year-specific IPMs with <code>ipmr</code><a href="adyr.html#building-the-year-specific-ipms-with-ipmr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As in the previous sections, we will rely heavily on the code we already wrote in Chapter 4. However, we will now implement the <code>_yr</code> suffix and utilize the parameter set functionality in ipmr. The first step is to stick all of our varying and constant parameters into a single list to give to ipmr.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="adyr.html#cb181-1" aria-hidden="true" tabindex="-1"></a>all_pars <span class="ot">&lt;-</span> <span class="fu">c</span>( pars_cons_wide, pars_var_wide )</span>
<span id="cb181-2"><a href="adyr.html#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="adyr.html#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( all_pars, &quot;data/Bou_gra_yr/all_pars.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>Now let‚Äôs build the proto-IPM. Some comments have been included in the following code to explain the new pieces, but refer back to Chapter 4 <a href="adwf.html#ipmr4">4.4.10</a> for more details about constructing the IPM in ipmr. I‚Äôm jumping right in to the full proto-IPM with both kernels. Note the use of the <code>_yr</code> suffix on all terms AND expressions which vary across the years, every time they are mentioned!!!</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="adyr.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( ipmr )</span>
<span id="cb182-2"><a href="adyr.html#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="adyr.html#cb182-3" aria-hidden="true" tabindex="-1"></a>proto_ipm_yr <span class="ot">&lt;-</span> <span class="fu">init_ipm</span>( <span class="at">sim_gen   =</span> <span class="st">&quot;simple&quot;</span>,</span>
<span id="cb182-4"><a href="adyr.html#cb182-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">di_dd     =</span> <span class="st">&quot;di&quot;</span>,</span>
<span id="cb182-5"><a href="adyr.html#cb182-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">det_stoch =</span> <span class="st">&quot;det&quot;</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb182-6"><a href="adyr.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-7"><a href="adyr.html#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define_kernel</span>(</span>
<span id="cb182-8"><a href="adyr.html#cb182-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">name             =</span> <span class="st">&quot;P_yr&quot;</span>,</span>
<span id="cb182-9"><a href="adyr.html#cb182-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family           =</span> <span class="st">&quot;CC&quot;</span>,</span>
<span id="cb182-10"><a href="adyr.html#cb182-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula          =</span> s_yr <span class="sc">*</span> g_yr,</span>
<span id="cb182-11"><a href="adyr.html#cb182-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">s_yr             =</span> <span class="fu">plogis</span>( surv_b0_yr <span class="sc">+</span> </span>
<span id="cb182-12"><a href="adyr.html#cb182-12" aria-hidden="true" tabindex="-1"></a>                          surv_b1_yr <span class="sc">*</span> size_1), </span>
<span id="cb182-13"><a href="adyr.html#cb182-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_yr             =</span> <span class="fu">dnorm</span>( size_2, mu_g_yr, grow_sig ),</span>
<span id="cb182-14"><a href="adyr.html#cb182-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu_g_yr          =</span> grow_b0_yr <span class="sc">+</span> grow_b1_yr <span class="sc">*</span> size_1 <span class="sc">+</span> grow_b2_yr <span class="sc">*</span> size_1<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb182-15"><a href="adyr.html#cb182-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">grow_sig         =</span> <span class="fu">sqrt</span>( a <span class="sc">*</span> <span class="fu">exp</span>( b <span class="sc">*</span> size_1 ) ),</span>
<span id="cb182-16"><a href="adyr.html#cb182-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_list        =</span> all_pars,</span>
<span id="cb182-17"><a href="adyr.html#cb182-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">states           =</span> <span class="fu">list</span>( <span class="fu">c</span>( <span class="st">&#39;size&#39;</span> ) ),</span>
<span id="cb182-18"><a href="adyr.html#cb182-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb182-19"><a href="adyr.html#cb182-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># these next two lines are new</span></span>
<span id="cb182-20"><a href="adyr.html#cb182-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the first tells ipmr that we are using parameter sets</span></span>
<span id="cb182-21"><a href="adyr.html#cb182-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">uses_par_sets    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb182-22"><a href="adyr.html#cb182-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the second defines the values the yr suffix can assume</span></span>
<span id="cb182-23"><a href="adyr.html#cb182-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">par_set_indices  =</span> <span class="fu">list</span>( <span class="at">yr =</span> <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span> ),</span>
<span id="cb182-24"><a href="adyr.html#cb182-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">evict_cor        =</span> <span class="cn">TRUE</span>,</span>
<span id="cb182-25"><a href="adyr.html#cb182-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">evict_fun        =</span> <span class="fu">truncated_distributions</span>( <span class="at">fun    =</span> <span class="st">&#39;norm&#39;</span>,</span>
<span id="cb182-26"><a href="adyr.html#cb182-26" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">target =</span> <span class="st">&#39;g_yr&#39;</span> )</span>
<span id="cb182-27"><a href="adyr.html#cb182-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb182-28"><a href="adyr.html#cb182-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-29"><a href="adyr.html#cb182-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define_kernel</span>(</span>
<span id="cb182-30"><a href="adyr.html#cb182-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">name             =</span> <span class="st">&#39;F_yr&#39;</span>,</span>
<span id="cb182-31"><a href="adyr.html#cb182-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">family           =</span> <span class="st">&#39;CC&#39;</span>,</span>
<span id="cb182-32"><a href="adyr.html#cb182-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula          =</span> fecu_b0_yr <span class="sc">*</span> r_d,</span>
<span id="cb182-33"><a href="adyr.html#cb182-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_d              =</span> <span class="fu">dnorm</span>( size_2, recr_sz, recr_sd ),</span>
<span id="cb182-34"><a href="adyr.html#cb182-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_list        =</span> all_pars,</span>
<span id="cb182-35"><a href="adyr.html#cb182-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">states           =</span> <span class="fu">list</span>( <span class="fu">c</span>( <span class="st">&#39;size&#39;</span> ) ),</span>
<span id="cb182-36"><a href="adyr.html#cb182-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">uses_par_sets    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb182-37"><a href="adyr.html#cb182-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">par_set_indices  =</span> <span class="fu">list</span>( <span class="at">yr =</span> <span class="dv">1997</span><span class="sc">:</span><span class="dv">2009</span> ),</span>
<span id="cb182-38"><a href="adyr.html#cb182-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">evict_cor        =</span> <span class="cn">TRUE</span>,</span>
<span id="cb182-39"><a href="adyr.html#cb182-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">evict_fun        =</span> <span class="fu">truncated_distributions</span>( <span class="st">&quot;norm&quot;</span>, <span class="st">&quot;r_d&quot;</span> )</span>
<span id="cb182-40"><a href="adyr.html#cb182-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb182-41"><a href="adyr.html#cb182-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-42"><a href="adyr.html#cb182-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define_impl</span>(</span>
<span id="cb182-43"><a href="adyr.html#cb182-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">make_impl_args_list</span>(</span>
<span id="cb182-44"><a href="adyr.html#cb182-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">kernel_names =</span> <span class="fu">c</span>( <span class="st">&quot;P_yr&quot;</span>, <span class="st">&quot;F_yr&quot;</span> ),</span>
<span id="cb182-45"><a href="adyr.html#cb182-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">int_rule     =</span> <span class="fu">rep</span>( <span class="st">&quot;midpoint&quot;</span>, <span class="dv">2</span> ),</span>
<span id="cb182-46"><a href="adyr.html#cb182-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_start  =</span> <span class="fu">rep</span>( <span class="st">&quot;size&quot;</span>, <span class="dv">2</span> ),</span>
<span id="cb182-47"><a href="adyr.html#cb182-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_end    =</span> <span class="fu">rep</span>( <span class="st">&quot;size&quot;</span>, <span class="dv">2</span> )</span>
<span id="cb182-48"><a href="adyr.html#cb182-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb182-49"><a href="adyr.html#cb182-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb182-50"><a href="adyr.html#cb182-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-51"><a href="adyr.html#cb182-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define_domains</span>(</span>
<span id="cb182-52"><a href="adyr.html#cb182-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">c</span>(all_pars<span class="sc">$</span>L,</span>
<span id="cb182-53"><a href="adyr.html#cb182-53" aria-hidden="true" tabindex="-1"></a>             all_pars<span class="sc">$</span>U,</span>
<span id="cb182-54"><a href="adyr.html#cb182-54" aria-hidden="true" tabindex="-1"></a>             all_pars<span class="sc">$</span>mat_siz</span>
<span id="cb182-55"><a href="adyr.html#cb182-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb182-56"><a href="adyr.html#cb182-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb182-57"><a href="adyr.html#cb182-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-58"><a href="adyr.html#cb182-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We also append the suffix in define_pop_state(). This will create a deterministic</span></span>
<span id="cb182-59"><a href="adyr.html#cb182-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation for every &quot;year&quot;</span></span>
<span id="cb182-60"><a href="adyr.html#cb182-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">define_pop_state</span>(</span>
<span id="cb182-61"><a href="adyr.html#cb182-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_size_yr =</span> <span class="fu">rep</span>( <span class="dv">1</span> <span class="sc">/</span> <span class="dv">200</span>, <span class="dv">200</span> )</span>
<span id="cb182-62"><a href="adyr.html#cb182-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb182-63"><a href="adyr.html#cb182-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-64"><a href="adyr.html#cb182-64" aria-hidden="true" tabindex="-1"></a>ipmr_yr <span class="ot">&lt;-</span> <span class="fu">make_ipm</span>( <span class="at">proto_ipm =</span> proto_ipm_yr,</span>
<span id="cb182-65"><a href="adyr.html#cb182-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">iterations =</span> <span class="dv">200</span> )</span>
<span id="cb182-66"><a href="adyr.html#cb182-66" aria-hidden="true" tabindex="-1"></a>lam_mean_ipmr <span class="ot">&lt;-</span> <span class="fu">lambda</span>( ipmr_yr )</span></code></pre></div>
<center>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Year
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
<i>n<sub>t0</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
<i>n<sub>t1</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Observed<br>population growth
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Yearly asymptotic<br>lambda
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Projected<br><i>n<sub>t1</sub></i>
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Projected<br>population growth
</th>
<th style="font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">
Lambda from ipmr
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1998
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
42
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
58
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.381
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.277
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
69
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.646
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.286
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1999
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
58
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
159
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.741
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.291
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
151
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.608
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.295
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2000
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
49
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
84
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.714
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.947
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
120
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2.446
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.955
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2001
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
84
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
74
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.881
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.076
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
97
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.15
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.085
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2002
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
174
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
934
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
5.368
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
3.678
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
653
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
3.75
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
3.68
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2003
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
934
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
286
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.306
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.907
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
363
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.388
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.747
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2004
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
286
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
283
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.99
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.896
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
214
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.748
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.803
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2005
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
283
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
173
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.611
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.974
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
216
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.763
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.941
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2006
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
173
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
233
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.347
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.257
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
213
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.23
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.256
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2007
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
233
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
314
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.348
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.165
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
276
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.186
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.167
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2008
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
314
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
342
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.089
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.027
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
325
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.035
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
1.034
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
2009
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
342
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
245
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.716
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.972
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
267
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.78
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; text-align: center;">
0.909
</td>
</tr>
<tr>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
2010
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
245
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
220
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.898
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.967
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
202
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.826
</td>
<td style="padding-left: 1.5em; padding-right: 1.5em; border-bottom: 2px solid grey; text-align: center;">
0.893
</td>
</tr>
</tbody>
</table>
</center>
<p>These lambda values seem pretty good! Let‚Äôs export them as a dataframe.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="adyr.html#cb183-1" aria-hidden="true" tabindex="-1"></a>lam_out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">coefficient =</span> <span class="fu">names</span>( lam_mean_ipmr ), </span>
<span id="cb183-2"><a href="adyr.html#cb183-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> lam_mean_ipmr )</span>
<span id="cb183-3"><a href="adyr.html#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="adyr.html#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>( lam_out ) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span></span>
<span id="cb183-5"><a href="adyr.html#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="adyr.html#cb183-6" aria-hidden="true" tabindex="-1"></a>lam_out_wide <span class="ot">&lt;-</span> <span class="fu">as.list</span>( <span class="fu">pivot_wider</span>( lam_out, <span class="at">names_from =</span> <span class="st">&quot;coefficient&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span> ) )</span>
<span id="cb183-7"><a href="adyr.html#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="adyr.html#cb183-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-9"><a href="adyr.html#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv( lam_out_wide, &quot;data/Bou_gra_yr/lambdas_yr.csv&quot;, row.names = F )</span></span></code></pre></div>
<p>Now, we can go ahead and begin filling in the database template.</p>
</div>
<div id="populating-the-padrino-database-template-1" class="section level3 hasAnchor" number="6.0.8">
<h3><span class="header-section-number">6.0.8</span> 11. Populating the PADRINO database template<a href="adyr.html#populating-the-padrino-database-template-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we are implementing the <code>_yr</code> suffix syntax to build all of our IPMs with parameter sets, we can actually store all 13 of these IPMs under a single IPM ID! For the sake of this example, we will use ‚Äúbg00yr‚Äù as our IPM ID.</p>
<p>In many tables, the only difference between what we have already entered in Chapter 4 and what we will enter now is the addition of the <code>_yr</code> suffix when appropriate, following the changes we made to the IPM in the last step. I will point out when tables change, as necessary. The biggest changes will come in the <code>ParameterValues</code> table, because we will need to load in many more values than previously.</p>
<p>Let‚Äôs start by loading in the Excel file of the empty template. Download the template from <a href="https://github.com/aspen1030/RUPDemo/blob/4e814fc5feb0cb06634cec51a56756b9fdf20c62/pdb_template.xlsx">here</a> and store it locally. Paste in the path to this script:</p>
<pre><code>library( readxl )

YOUR_PATH &lt;- &quot;this is where you should paste the path to the folder where you&#39;ve stored your file&quot;
sheet_names &lt;- excel_sheets( paste( YOUR_PATH, &quot;/pdb_template.xlsx&quot;, sep = &quot;&quot; ) )
pdb &lt;- lapply( sheet_names, function( x ) {
  as.data.frame( read_excel( paste( YOUR_PATH, &quot;/pdb_template.xlsx&quot;, sep = &quot;&quot; ), sheet = x ) ) } )
names( pdb ) &lt;- sheet_names</code></pre>
<p>Next, we can populate the <code>Metadata</code> table. Note that we are changing the IPM ID and the kernel names.</p>
<pre><code>pdb$Metadata[1,] &lt;- c( &quot;bg00yr&quot;, 
                       
                       # Taxonomic information
                       &quot;Bouteloua gracilis&quot;, &quot;Bouteloua gracilis&quot;, &quot;Bouteloua&quot;,
                       &quot;Poaceae&quot;, &quot;Poales&quot;, &quot;Liliopsida&quot;, &quot;Magnoliophyta&quot;,
                       &quot;Plantae&quot;, &quot;Herbaceous&quot;, &quot;Monocot&quot;, &quot;angio&quot;, 
                       
                       # Publication information
                       &quot;Chu; Norman; Flynn; Kaplan; Lauenroth; Adler&quot;,
                       &quot;Ecology&quot;, &quot;2013&quot;, &quot;10.1890/13-0121.1&quot;, &quot;Adler&quot;, 
                       &quot;peter.adler@usu.edu (2023)&quot;, NA, 
                       &quot;Chu, C., Norman, J., Flynn, R., Kaplan, N., Lauenroth,
                       W.K. and Adler, P.B. (2013), Cover, density, and
                       demographics of shortgrass steppe plants mapped 1997‚Äì2010
                       in permanent grazed and ungrazed quadrats. Ecology, 94:
                       1435-1435. https://doi.org/10.1890/13-0121.1&quot;,
                       &quot;https://doi.org/10.6084/m9.figshare.c.3305970.v1&quot;,
                       
                       # Data collection information
                       14, 1997, NA, 2010, NA, 1, &quot;Shortgrass Steppe LTER&quot;, &quot;6&quot;, 
                       &quot;40.84519843&quot;, &quot;-104.7107395&quot;, &quot;1652.2&quot;, &quot;USA&quot;,
                       &quot;n_america&quot;, &quot;TGS&quot;,
                       
                       # Model information
                       &quot;A&quot;, TRUE, &quot;truncated_distributions&quot;, &quot;P_yr; F_yr&quot;, NA, FALSE,
                       FALSE, FALSE, FALSE, &quot;&quot;, &quot;&quot;, &quot;&quot;
                        )
                        
pdb$Metadata$eviction_used &lt;- as.logical(pdb$Metadata$eviction_used)
pdb$Metadata$duration &lt;- as.numeric(pdb$Metadata$duration)
pdb$Metadata$periodicity &lt;- as.numeric(pdb$Metadata$periodicity)</code></pre>
<p>In the <code>StateVariables</code>, <code>ContinuousDomains</code>, <code>IntegrationRules</code>, and <code>StateVectors</code> tables, we also only change the IPM ID and add the suffix to the kernel names:</p>
<pre><code>pdb$StateVariables[1,] &lt;- c( &quot;bg00yr&quot;, &quot;size&quot;, FALSE)
pdb$StateVariables$discrete &lt;- as.logical( pdb$StateVariables$discrete )

pdb$ContinuousDomains[1,] &lt;- c( &quot;bg00yr&quot;, 
                                &quot;size&quot;, 
                                &quot;&quot;, 
                                all_pars$L, 
                                all_pars$U, 
                                &quot;P_yr; F_yr&quot;, 
                                &quot;&quot; )
pdb$ContinuousDomains$lower &lt;- as.numeric( pdb$ContinuousDomains$lower )
pdb$ContinuousDomains$upper &lt;- as.numeric( pdb$ContinuousDomains$upper )

pdb$IntegrationRules[1,] &lt;- c( &quot;bg00yr&quot;,
                               &quot;size&quot;,
                               &quot;&quot;,
                               all_pars$mat_siz,
                               &quot;midpoint&quot;,
                               &quot;P_yr; F_yr&quot; )
pdb$IntegrationRules$n_meshpoints &lt;- as.numeric( pdb$IntegrationRules$n_meshpoints )

pdb$StateVectors[1,] &lt;- c( &quot;bg00yr&quot;,
                           &quot;n_size&quot;,
                           all_pars$mat_siz,
                           &quot;&quot; )
pdb$StateVectors$n_bins &lt;- as.numeric( pdb$StateVectors$n_bins )
</code></pre>
<p>At the <code>IpmKernels</code> table, we again change the IPM ID and kernel names, but we also add the <code>_yr</code> suffix to the vital rate expression names.</p>
<pre><code>pdb$IpmKernels[1,] &lt;- c( &quot;bg00yr&quot;, 
                         &quot;P_yr&quot;, 
                         &quot;P_yr = s_yr * g_yr * d_size&quot;, 
                         &quot;CC&quot;, 
                         &quot;size&quot;, 
                         &quot;size&quot; )

pdb$IpmKernels[2,] &lt;- c( &quot;bg00yr&quot;, 
                         &quot;F_yr&quot;, 
                         &quot;F_yr = fy_yr * d_size&quot;, 
                         &quot;CC&quot;, 
                         &quot;size&quot;, 
                         &quot;size&quot; )</code></pre>
<p>We follow through with this in the <code>VitalRateExpr</code> sheet, making sure to also update the growth vital rate expression with the new model!</p>
<pre><code>pdb$VitalRateExpr[1,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Survival&quot;,
                            &quot;s_yr = 1 / ( 1 + exp( -( surv_b0_yr + surv_b1_yr * size_1 ) ) )&quot;,
                            &quot;Evaluated&quot;,
                            &quot;P_yr&quot; )

pdb$VitalRateExpr[2,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Growth&quot;,
                            &quot;mu_g_yr = grow_b0_yr + grow_b1_yr * size_1 + grow_b2_yr * size_1^2&quot;,
                            &quot;Evaluated&quot;,
                            &quot;P_yr&quot; )

pdb$VitalRateExpr[3,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Growth&quot;,
                            &quot;g_yr = Norm( mu_g_yr, sd_g )&quot;,
                            &quot;Substituted&quot;,
                            &quot;P_yr&quot; )

pdb$VitalRateExpr[4,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Growth&quot;,
                            &quot;sd_g = sqrt( a * exp( b * size_1 ) )&quot;,
                            &quot;Evaluated&quot;,
                            &quot;P_yr&quot; )

pdb$VitalRateExpr[5,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Fecundity&quot;,
                            &quot;fy_yr = fecu_b0_yr * r_d&quot;,
                            &quot;Evaluated&quot;,
                            &quot;F_yr&quot; )

pdb$VitalRateExpr[6,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;Fecundity&quot;,
                            &quot;r_d = Norm( recr_sz, recr_sd )&quot;,
                            &quot;Substituted&quot;,
                            &quot;F_yr&quot; )</code></pre>
<p>From this point forward, we will be making bigger changes. In the <code>ParameterValues</code> sheet, we need to enter the parameter values which will remain constant throughout all years (a, b, recr_sz, recr_sd), but we will also need to enter all values of the parameters which vary across the years. To accomplish this, I will use a <code>for</code> loop, even though this is a less efficient approach. The <code>for</code> loop will populate the first 78 rows of the sheet with the varying parameters, and then I will manually enter the constant parameters afterwards.</p>
<pre><code>for( i in 1:( length( pars_var_wide ) ) ) {
  pdb$ParameterValues[i,1] &lt;- &quot;bg00yr&quot;
  pdb$ParameterValues[i,3] &lt;- &quot;size&quot;
  pdb$ParameterValues[i,4] &lt;- names( pars_var_wide )[i]
  pdb$ParameterValues[i,5] &lt;- as.numeric( pars_var_wide[i] )
  
  if( grepl( &quot;surv&quot;, names( pars_var_wide )[i] ) ){
    pdb$ParameterValues[i,2] &lt;- &quot;Survival&quot;
  } else {
    if( grepl( &quot;grow&quot;, names( pars_var_wide )[i] ) ){
      pdb$ParameterValues[i,2] &lt;- &quot;Growth&quot;
    } else { pdb$ParameterValues[i,2] &lt;- &quot;Fecundity&quot; }
  }
}

pdb$ParameterValues[79,] &lt;- c( &quot;bg00yr&quot;,
                               &quot;Growth&quot;,
                               &quot;size&quot;,
                               &quot;a&quot;,
                               all_pars$a )
pdb$ParameterValues[80,] &lt;- c( &quot;bg00yr&quot;,
                               &quot;Growth&quot;,
                               &quot;size&quot;,
                               &quot;b&quot;,
                               all_pars$b )                               
pdb$ParameterValues[81,] &lt;- c( &quot;bg00yr&quot;,
                               &quot;Fecundity&quot;,
                               &quot;size&quot;,
                               &quot;recr_sz&quot;,
                               all_pars$recr_sz )
pdb$ParameterValues[82,] &lt;- c( &quot;bg00yr&quot;,
                               &quot;Fecundity&quot;,
                               &quot;size&quot;,
                               &quot;recr_sd&quot;,
                               all_pars$recr_sd )
                               
pdb$ParameterValues$parameter_value &lt;- as.numeric( pdb$ParameterValues$parameter_value )</code></pre>
<p>As in Chapter 4, we skip the <code>EnvironmentalVariables</code> table, but we will need to populate the <code>ParSetIndices</code> this time. This table tells ipmr the values which our <code>_yr</code> suffix can take.</p>
<pre><code>pdb$ParSetIndices[1,] &lt;- c( &quot;bg00yr&quot;,
                            &quot;year&quot;,
                            &quot;yr&quot;,
                            &quot;1997:2009&quot;,
                            &quot;P_yr; F_yr&quot;,
                            &quot;&quot; )</code></pre>
<p>Again, we skip the <code>UncertaintyTable</code> and move onto the last table, <code>TestTargets</code>. Like our <code>ParameterValues</code> table, we also need to enter year-specific information, this time those year-specific lambdas.</p>
<pre><code>pdb$TestTargets[1:13,1] &lt;- &quot;bg00yr&quot;
pdb$TestTargets[1:13,2] &lt;- names(lam_mean_ipmr)
pdb$TestTargets[1:13,3] &lt;- as.numeric(lam_mean_ipmr)
pdb$TestTargets[1:13,4] &lt;- 3

pdb$TestTargets$target_value &lt;- as.numeric( pdb$TestTargets$target_value )
pdb$TestTargets$precision &lt;- as.numeric( pdb$TestTargets$precision )</code></pre>
<p>Once all of the necessary sheets have been filled, export the <code>pdb</code> file to Excel, storing it in the project home folder.</p>
<pre><code>library( writexl )
write_xlsx( pdb, &quot;Bou_gra_yr_pdb.xlsx&quot; )</code></pre>
<p>Now, we must test the <code>pdb</code> file to make sure ipmr can recreate the models from the Excel tables.</p>
<pre><code>library( pdbDigitUtils )
pdb_test       &lt;- read_pdb( &quot;Bou_gra_yr_pdb.xlsx&quot; )
pdb_test_proto &lt;- pdb_make_proto_ipm( pdb_test, det_stoch = &quot;det&quot; )
print( pdb_test_proto$bg00yr )
bg_ipm_pdb &lt;- make_ipm( pdb_test_proto$bg00yr )
bg_ipm_pdb
lambda( bg_ipm_pdb )
test_model( pdb_test, id = &quot;bg00yr&quot; )</code></pre>
<p>Following all of these steps exactly, I did not get any errors and the model passed the test!</p>
</div>
<div id="finishing-up-the-digitization-project-1" class="section level3 hasAnchor" number="6.0.9">
<h3><span class="header-section-number">6.0.9</span> 12. Finishing up the digitization project<a href="adyr.html#finishing-up-the-digitization-project-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we‚Äôve been following along with all of the steps, all of the files should be organized correctly! We just need to finalize the notes and wrapper files.</p>
<p>The notes file, ‚ÄúBou_gra_yr_notes.txt,‚Äù should contain the following information:</p>
<blockquote>
<ul>
<li>Thirteen year-specific simple, deterministic, density-independent IPMs were constructed from these data. All data were aggregated by treatment to fit the vital rate models.</li>
<li>Raw data were loaded from the ‚ÄúBou_gra‚Äù mean model digitization project; no more extra filtering steps took place.</li>
<li>The year-specific recruitment rates were calculated as the mean per-capita rates of recruitment across all plots, based on the number of adults observed at time t0 of a given year and the number of recruits observed at time t1 (the following year).</li>
<li>The parameters of the growth variance model, a and b, as well as the parameters defining the probability density distribution describing recruit size, recruit size mean and standard deviation, were held constant across all years, while all other vital rate parameters varied across the years.</li>
</ul>
</blockquote>
As before, let‚Äôs take a look at the organization of the project folder before writing the wrapper file:
<center>
<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<tbody>
<tr style="border-top: 2px solid grey;">
<td style="border-top: 2px solid grey; text-align: left;">
üìÅ Adler_Colorado
</td>
<td style="border-top: 2px solid grey; text-align: left;">
</td>
<td style="border-top: 2px solid grey; text-align: left;">
</td>
<td style="border-top: 2px solid grey; text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">üÖÅ</span> Adler_Colorado.Rproj
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ data
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ Bou_gra_yr
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> surv_pars.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> grow_pars.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> recr_pars.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> pars_cons.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> pars_var.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> all_pars.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> lambdas_yr.csv
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ R
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ Bou_gra_yr
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> 01_Plotting.R
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> 02_VitalRates.R
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> 03_IPMScratch.R
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> 04_ipmr.R
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> 05_PADRINO.R
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ results
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üìÅ Bou_gra
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üìÅ Bou_gra_yr
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
‚Ü≥
</td>
<td style="text-align: left;">
üñª histograms.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª survival_binned_yr.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª growth_yr.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª recruit_yr.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª recr_histograms.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª survival_pred.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª grow_pred.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª grow_pred_2.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª recruit_pred.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñª obs_proj_lambdas.png
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñ∫ Chu_2013_fulltext.pdf
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> Bou_gra_pdb.xlsx
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:forestgreen;">üÖá</span> Bou_gra_yr_pdb.xlsx
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñπ Bou_gra_notes.txt
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
üñπ Bou_gra_yr_notes.txt
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> Bou_gra_wrapper.R
</td>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">
</td>
<td style="border-bottom: 2px solid grey; text-align: left;">
<span style="color:dodgerblue;">‚ìá</span> Bou_gra_yr_wrapper.R
</td>
<td style="border-bottom: 2px solid grey; text-align: left;">
</td>
<td style="border-bottom: 2px solid grey; text-align: left;">
</td>
</tr>
</tbody>
</table>
</center>
<p>And finally, let‚Äôs write the wrapper:</p>
<pre><code># Chu et al. 2013: Bouteloua gracilis year-specific IPMs for PADRINO
# Aspen Workman, summer 2024

# Setup
library( bblme ) # ver 1.0.25
library( ggplot2 ) # ver 3.4.4
library( htmlTable ) # ver 2.4.2
library( ipmr ) # ver 0.0.7
library( lme4 ) # ver 1.1-33
library( patchwork ) # ver 1.1.2
library( pdbDigitUtils ) # ver 0.0.0.90
library( readxl ) # ver 1.4.2
library( tidyverse ) # ver 2.0.0
library( writexl ) # ver 1.4.2

base_dir &lt;- dirname( rstudioapi::getActiveDocumentContext()$path )
R_dir &lt;- paste( base_dir, &quot;/R/Bou_gra_yr/&quot;, sep = &quot;&quot; )

setwd( base_dir )


# Overview ---------------------------------------------------------------------

# This R project concerns the construction of IPMs based on chart quadrat data 
  # from Chu et al., 2013. This file focuses on the dataset of Bouteloua
  # gracilis, which was converted from chart quadrat data to demographic data by
  # A. Workman and A. Compagnoni using plantTracker. The dataset consists of 13
  # transitions from 24 plots in Colorado, USA. Thirteen year-specific, simple, 
  # deterministic, density-independent IPMs were constructed from these data, 
  # representing the year-specific models. These IPMs were formatted for 
  # inclusion in the PADRINO database.
  
# Citation of data source:
  # Chu, C., Norman, J., Flynn, R., Kaplan, N., Lauenroth, W.K. and Adler, P.B. 
  # (2013), Cover, density, and demographics of shortgrass steppe plants mapped 
  # 1997‚Äì2010 in permanent grazed and ungrazed quadrats. Ecology, 94: 1435-1435. 
  # https://doi.org/10.1890/13-0121.1
  

# Project organization ---------------------------------------------------------

# Contained within the R project are all of the files needed to construct and
  # test multiple IPMs. The files which refer to the year-specific models for 
  # Bouteloua gracilis are indicated by the abbreviation &quot;Bou_gra_yr.&quot; The home 
  # folder of the project contains the finalized PADRINO database Excel file
  # (&quot;Bou_gra_yr_pdb.xlsx&quot;), a text file describing decisions that were made
  # about the data during the modeling process (&quot;Bou_gra_yr_notes.txt&quot;) and this 
  # wrapper file.
  
# Input data are stored in the &#39;data/Bou_gra&#39; subfolder. The raw data, 
  # &quot;Bou_gra.csv&quot;, is the output from plantTracker filtered for only occurrences
  # of Bouteloua gracilis. The data files &quot;Bou_gra_clean.csv&quot;, and the
  # dataframes ending in &quot;_mod.csv&quot; were used to fit the vital rate models for
  # the year-specific IPMs. The steps to generate these input data files are
  # contained within the R scripts found in the &#39;R/Bou_gra&#39; subfolder. All data
  # files which are outputted during the construction of the year-specific IPMs
  # are stored in the &#39;data/Bou_gra_yr&#39; subfolder, and the steps to generate
  # these files are contained within the R scripts found in the &#39;R/Bou_gra_yr&#39; 
  # subfolder.
  
# The R scripts are stored in the &#39;R/Bou_gra_yr&#39; subfolder. The number prefix of
  # the file name indicates the order in which the scripts should be executed.
  
# Plots which were created throughout the course of this project are stored in 
  # the &#39;results/Bou_gra_yr&#39; subfolder. Plots with the &quot;_pred&quot; suffix in the  
  # file name indicate visualizations of the vital rate models, while all other 
  # plots are visualizations of the raw data.


# Workflow ---------------------------------------------------------------------

# Visualize the raw data
source( paste0( R_dir, &quot;01_Plotting.R&quot; ) )

# Fit vital rate models
source( paste0( R_dir, &quot;02_VitalRates.R&quot; ) )

# Construct IPMs from scratch
source( paste0( R_dir, &quot;03_IPMScratch.R&quot; ) )

# Construct IPMs using ipmr syntax
source( paste0( R_dir, &quot;04_ipmr.R&quot; ) )

# Populate the PADRINO database template
source( paste0( R_dir, &quot;05_PADRINO.R&quot; ) )

</code></pre>
<p>As before, now that we‚Äôve finished the wrapper file and all of the files are organized, we should make sure the entire project is uploaded or otherwise synced to whatever cloud service we‚Äôve decided to use. Since we‚Äôve already updated the Incoming literature Google Sheet, all that is left is to celebrate!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="adex.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
